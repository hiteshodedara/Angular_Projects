import { ChangeDetectionStrategy, Component, Inject, Input, Optional, Output, } from '@angular/core';
import { convertToBoolProperty } from '../helpers';
import { NB_DOCUMENT } from '../../theme.options';
import { NbCalendarWithTimeComponent } from './calendar-with-time.component';
import { NbBasePickerComponent } from './datepicker.component';
import { NB_DATE_SERVICE_OPTIONS } from './datepicker.directive';
import * as i0 from "@angular/core";
import * as i1 from "../cdk/overlay/overlay-position";
import * as i2 from "../cdk/overlay/overlay-trigger";
import * as i3 from "../cdk/overlay/overlay-service";
import * as i4 from "../calendar-kit/services/date.service";
import * as i5 from "../calendar-kit/services/calendar-time-model.service";
/**
 * The DateTimePicker component itself.
 * Provides a proxy to `NbCalendarWithTimeComponent` options as well as custom picker options.
 */
export class NbDateTimePickerComponent extends NbBasePickerComponent {
    get value() {
        return this.picker ? this.picker.date : undefined;
    }
    set value(date) {
        if (!this.picker) {
            this.queue = date;
            return;
        }
        if (date) {
            this.visibleDate = date;
            this.picker.visibleDate = date;
            this.picker.date = date;
            this.picker.cd.markForCheck();
        }
    }
    /**
     * Defines 12 hours format like '07:00 PM'.
     * */
    get twelveHoursFormat() {
        return this._twelveHoursFormat;
    }
    set twelveHoursFormat(value) {
        this._twelveHoursFormat = convertToBoolProperty(value);
    }
    /**
     * Defines should show am/pm label if twelveHoursFormat enabled.
     * */
    get showAmPmLabel() {
        return this._showAmPmLabel;
    }
    set showAmPmLabel(value) {
        this._showAmPmLabel = convertToBoolProperty(value);
    }
    /**
     * Show seconds in timepicker.
     * Ignored when singleColumn is true.
     * */
    get withSeconds() {
        return this._withSeconds;
    }
    set withSeconds(value) {
        this._withSeconds = convertToBoolProperty(value);
    }
    /**
     * Show timepicker values in one column with 60 minutes step by default.
     * */
    get singleColumn() {
        return this._singleColumn;
    }
    set singleColumn(value) {
        this._singleColumn = convertToBoolProperty(value);
    }
    /**
     * Emits date with time when selected.
     * */
    get dateTimeChange() {
        return this.valueChange;
    }
    constructor(document, positionBuilder, triggerStrategyBuilder, overlay, cfr, dateService, dateServiceOptions, calendarWithTimeModelService) {
        super(document, positionBuilder, triggerStrategyBuilder, overlay, cfr, dateService, dateServiceOptions);
        this.calendarWithTimeModelService = calendarWithTimeModelService;
        this.pickerClass = NbCalendarWithTimeComponent;
        this.showCurrentTimeButton = true;
        this._showAmPmLabel = true;
    }
    ngOnInit() {
        this.format = this.format || this.buildTimeFormat();
        this.init$.next();
    }
    patchWithInputs() {
        this.picker.singleColumn = this.singleColumn;
        this.picker.twelveHoursFormat = this.twelveHoursFormat;
        this.picker.showAmPmLabel = this.showAmPmLabel;
        this.picker.withSeconds = this.withSeconds;
        this.picker.step = this.step;
        this.picker.title = this.title;
        this.picker.applyButtonText = this.applyButtonText;
        this.picker.currentTimeButtonText = this.currentTimeButtonText;
        this.picker.showCurrentTimeButton = this.showCurrentTimeButton;
        if (this.twelveHoursFormat) {
            this.picker.timeFormat = this.dateService.getTwelveHoursFormat();
        }
        else {
            this.picker.timeFormat =
                this.withSeconds && !this.singleColumn
                    ? this.dateService.getTwentyFourHoursFormatWithSeconds()
                    : this.dateService.getTwentyFourHoursFormat();
        }
        super.patchWithInputs();
        this.picker.cd.markForCheck();
    }
    get pickerValueChange() {
        return this.picker.dateChange;
    }
    writeQueue() {
        if (this.queue) {
            const date = this.queue;
            this.queue = null;
            this.value = date;
        }
    }
    buildTimeFormat() {
        if (this.singleColumn) {
            return this.calendarWithTimeModelService.buildDateFormat(this.twelveHoursFormat);
        }
        else {
            return this.calendarWithTimeModelService.buildDateFormat(this.twelveHoursFormat, this.withSeconds);
        }
    }
}
NbDateTimePickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbDateTimePickerComponent, deps: [{ token: NB_DOCUMENT }, { token: i1.NbPositionBuilderService }, { token: i2.NbTriggerStrategyBuilderService }, { token: i3.NbOverlayService }, { token: i0.ComponentFactoryResolver }, { token: i4.NbDateService }, { token: NB_DATE_SERVICE_OPTIONS, optional: true }, { token: i5.NbCalendarTimeModelService }], target: i0.ɵɵFactoryTarget.Component });
NbDateTimePickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.4", type: NbDateTimePickerComponent, selector: "nb-date-timepicker", inputs: { step: "step", title: "title", applyButtonText: "applyButtonText", currentTimeButtonText: "currentTimeButtonText", showCurrentTimeButton: "showCurrentTimeButton", twelveHoursFormat: "twelveHoursFormat", showAmPmLabel: "showAmPmLabel", withSeconds: "withSeconds", singleColumn: "singleColumn" }, outputs: { dateTimeChange: "dateTimeChange" }, usesInheritance: true, ngImport: i0, template: '', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbDateTimePickerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'nb-date-timepicker',
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [NB_DOCUMENT]
                }] }, { type: i1.NbPositionBuilderService }, { type: i2.NbTriggerStrategyBuilderService }, { type: i3.NbOverlayService }, { type: i0.ComponentFactoryResolver }, { type: i4.NbDateService }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [NB_DATE_SERVICE_OPTIONS]
                }] }, { type: i5.NbCalendarTimeModelService }]; }, propDecorators: { step: [{
                type: Input
            }], title: [{
                type: Input
            }], applyButtonText: [{
                type: Input
            }], currentTimeButtonText: [{
                type: Input
            }], showCurrentTimeButton: [{
                type: Input
            }], twelveHoursFormat: [{
                type: Input
            }], showAmPmLabel: [{
                type: Input
            }], withSeconds: [{
                type: Input
            }], singleColumn: [{
                type: Input
            }], dateTimeChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvdGhlbWUvY29tcG9uZW50cy9kYXRlcGlja2VyL2RhdGUtdGltZXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBR1QsTUFBTSxFQUNOLEtBQUssRUFFTCxRQUFRLEVBQ1IsTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxxQkFBcUIsRUFBa0IsTUFBTSxZQUFZLENBQUM7QUFDbkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBTWxELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7Ozs7O0FBRWpFOzs7R0FHRztBQU1ILE1BQU0sT0FBTyx5QkFDWCxTQUFRLHFCQUEyRDtJQUtuRSxJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDcEQsQ0FBQztJQUNELElBQUksS0FBSyxDQUFDLElBQVM7UUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsT0FBTztTQUNSO1FBRUQsSUFBSSxJQUFJLEVBQUU7WUFDUixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztZQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQWFEOztTQUVLO0lBQ0wsSUFDSSxpQkFBaUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDakMsQ0FBQztJQUNELElBQUksaUJBQWlCLENBQUMsS0FBYztRQUNsQyxJQUFJLENBQUMsa0JBQWtCLEdBQUcscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUlEOztTQUVLO0lBQ0wsSUFDSSxhQUFhO1FBQ2YsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzdCLENBQUM7SUFDRCxJQUFJLGFBQWEsQ0FBQyxLQUFjO1FBQzlCLElBQUksQ0FBQyxjQUFjLEdBQUcscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUlEOzs7U0FHSztJQUNMLElBQ0ksV0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0lBQ0QsSUFBSSxXQUFXLENBQUMsS0FBYztRQUM1QixJQUFJLENBQUMsWUFBWSxHQUFHLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFJRDs7U0FFSztJQUNMLElBQ0ksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBQ0QsSUFBSSxZQUFZLENBQUMsS0FBYztRQUM3QixJQUFJLENBQUMsYUFBYSxHQUFHLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFJRDs7U0FFSztJQUNMLElBQWMsY0FBYztRQUMxQixPQUFPLElBQUksQ0FBQyxXQUE4QixDQUFDO0lBQzdDLENBQUM7SUFFRCxZQUN1QixRQUFRLEVBQzdCLGVBQXlDLEVBQ3pDLHNCQUF1RCxFQUN2RCxPQUF5QixFQUN6QixHQUE2QixFQUM3QixXQUE2QixFQUNnQixrQkFBa0IsRUFDckQsNEJBQTJEO1FBRXJFLEtBQUssQ0FBQyxRQUFRLEVBQUUsZUFBZSxFQUFFLHNCQUFzQixFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFGOUYsaUNBQTRCLEdBQTVCLDRCQUE0QixDQUErQjtRQWxHN0QsZ0JBQVcsR0FBeUMsMkJBQTJCLENBQUM7UUE0QmpGLDBCQUFxQixHQUFHLElBQUksQ0FBQztRQXlCNUIsbUJBQWMsR0FBWSxJQUFJLENBQUM7SUFnRHpDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFUyxlQUFlO1FBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7UUFDdkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDO1FBQy9ELElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDO1FBRS9ELElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQzFCLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztTQUNsRTthQUFNO1lBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVO2dCQUNwQixJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVk7b0JBQ3BDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLG1DQUFtQyxFQUFFO29CQUN4RCxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1NBQ25EO1FBQ0QsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXhCLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxJQUFjLGlCQUFpQjtRQUM3QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ2hDLENBQUM7SUFFUyxVQUFVO1FBQ2xCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNkLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7U0FDbkI7SUFDSCxDQUFDO0lBRVMsZUFBZTtRQUN2QixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsNEJBQTRCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQ2xGO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUNwRztJQUNILENBQUM7O3NIQTFKVSx5QkFBeUIsa0JBK0YxQixXQUFXLHlNQU1DLHVCQUF1QjswR0FyR2xDLHlCQUF5QixnYkFIMUIsRUFBRTsyRkFHRCx5QkFBeUI7a0JBTHJDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtvQkFDOUIsUUFBUSxFQUFFLEVBQUU7b0JBQ1osZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEOzswQkFnR0ksTUFBTTsyQkFBQyxXQUFXOzswQkFNbEIsUUFBUTs7MEJBQUksTUFBTTsyQkFBQyx1QkFBdUI7cUZBMUVwQyxJQUFJO3NCQUFaLEtBQUs7Z0JBRUcsS0FBSztzQkFBYixLQUFLO2dCQUNHLGVBQWU7c0JBQXZCLEtBQUs7Z0JBQ0cscUJBQXFCO3NCQUE3QixLQUFLO2dCQUNHLHFCQUFxQjtzQkFBN0IsS0FBSztnQkFNRixpQkFBaUI7c0JBRHBCLEtBQUs7Z0JBY0YsYUFBYTtzQkFEaEIsS0FBSztnQkFlRixXQUFXO3NCQURkLEtBQUs7Z0JBY0YsWUFBWTtzQkFEZixLQUFLO2dCQWFRLGNBQWM7c0JBQTNCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBUeXBlLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgY29udmVydFRvQm9vbFByb3BlcnR5LCBOYkJvb2xlYW5JbnB1dCB9IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IHsgTkJfRE9DVU1FTlQgfSBmcm9tICcuLi8uLi90aGVtZS5vcHRpb25zJztcbmltcG9ydCB7IE5iUG9zaXRpb25CdWlsZGVyU2VydmljZSB9IGZyb20gJy4uL2Nkay9vdmVybGF5L292ZXJsYXktcG9zaXRpb24nO1xuaW1wb3J0IHsgTmJUcmlnZ2VyU3RyYXRlZ3lCdWlsZGVyU2VydmljZSB9IGZyb20gJy4uL2Nkay9vdmVybGF5L292ZXJsYXktdHJpZ2dlcic7XG5pbXBvcnQgeyBOYk92ZXJsYXlTZXJ2aWNlIH0gZnJvbSAnLi4vY2RrL292ZXJsYXkvb3ZlcmxheS1zZXJ2aWNlJztcbmltcG9ydCB7IE5iQ2FsZW5kYXJUaW1lTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi4vY2FsZW5kYXIta2l0L3NlcnZpY2VzL2NhbGVuZGFyLXRpbWUtbW9kZWwuc2VydmljZSc7XG5pbXBvcnQgeyBOYkRhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vY2FsZW5kYXIta2l0L3NlcnZpY2VzL2RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBOYkNhbGVuZGFyV2l0aFRpbWVDb21wb25lbnQgfSBmcm9tICcuL2NhbGVuZGFyLXdpdGgtdGltZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTmJCYXNlUGlja2VyQ29tcG9uZW50IH0gZnJvbSAnLi9kYXRlcGlja2VyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOQl9EQVRFX1NFUlZJQ0VfT1BUSU9OUyB9IGZyb20gJy4vZGF0ZXBpY2tlci5kaXJlY3RpdmUnO1xuXG4vKipcbiAqIFRoZSBEYXRlVGltZVBpY2tlciBjb21wb25lbnQgaXRzZWxmLlxuICogUHJvdmlkZXMgYSBwcm94eSB0byBgTmJDYWxlbmRhcldpdGhUaW1lQ29tcG9uZW50YCBvcHRpb25zIGFzIHdlbGwgYXMgY3VzdG9tIHBpY2tlciBvcHRpb25zLlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduYi1kYXRlLXRpbWVwaWNrZXInLFxuICB0ZW1wbGF0ZTogJycsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBOYkRhdGVUaW1lUGlja2VyQ29tcG9uZW50PEQ+XG4gIGV4dGVuZHMgTmJCYXNlUGlja2VyQ29tcG9uZW50PEQsIEQsIE5iQ2FsZW5kYXJXaXRoVGltZUNvbXBvbmVudDxEPj5cbiAgaW1wbGVtZW50cyBPbkluaXRcbntcbiAgcHJvdGVjdGVkIHBpY2tlckNsYXNzOiBUeXBlPE5iQ2FsZW5kYXJXaXRoVGltZUNvbXBvbmVudDxEPj4gPSBOYkNhbGVuZGFyV2l0aFRpbWVDb21wb25lbnQ7XG5cbiAgZ2V0IHZhbHVlKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMucGlja2VyID8gdGhpcy5waWNrZXIuZGF0ZSA6IHVuZGVmaW5lZDtcbiAgfVxuICBzZXQgdmFsdWUoZGF0ZTogYW55KSB7XG4gICAgaWYgKCF0aGlzLnBpY2tlcikge1xuICAgICAgdGhpcy5xdWV1ZSA9IGRhdGU7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIHRoaXMudmlzaWJsZURhdGUgPSBkYXRlO1xuICAgICAgdGhpcy5waWNrZXIudmlzaWJsZURhdGUgPSBkYXRlO1xuICAgICAgdGhpcy5waWNrZXIuZGF0ZSA9IGRhdGU7XG4gICAgICB0aGlzLnBpY2tlci5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVmaW5lcyBtaW51dGVzIHN0ZXAgd2hlbiB3ZSB1c2UgZmlsbCB0aW1lIGZvcm1hdC5cbiAgICogSWYgc2V0IHRvIDIwLCBpdCB3aWxsIGJlOiAnMTI6MDAsIDEyOjIwOiAxMjo0MCwgMTM6MDAuLi4nXG4gICAqICovXG4gIEBJbnB1dCgpIHN0ZXA6IG51bWJlcjtcblxuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xuICBASW5wdXQoKSBhcHBseUJ1dHRvblRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgY3VycmVudFRpbWVCdXR0b25UZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHNob3dDdXJyZW50VGltZUJ1dHRvbiA9IHRydWU7XG5cbiAgLyoqXG4gICAqIERlZmluZXMgMTIgaG91cnMgZm9ybWF0IGxpa2UgJzA3OjAwIFBNJy5cbiAgICogKi9cbiAgQElucHV0KClcbiAgZ2V0IHR3ZWx2ZUhvdXJzRm9ybWF0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl90d2VsdmVIb3Vyc0Zvcm1hdDtcbiAgfVxuICBzZXQgdHdlbHZlSG91cnNGb3JtYXQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl90d2VsdmVIb3Vyc0Zvcm1hdCA9IGNvbnZlcnRUb0Jvb2xQcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgX3R3ZWx2ZUhvdXJzRm9ybWF0OiBib29sZWFuO1xuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfdHdlbHZlSG91cnNGb3JtYXQ6IE5iQm9vbGVhbklucHV0O1xuXG4gIC8qKlxuICAgKiBEZWZpbmVzIHNob3VsZCBzaG93IGFtL3BtIGxhYmVsIGlmIHR3ZWx2ZUhvdXJzRm9ybWF0IGVuYWJsZWQuXG4gICAqICovXG4gIEBJbnB1dCgpXG4gIGdldCBzaG93QW1QbUxhYmVsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zaG93QW1QbUxhYmVsO1xuICB9XG4gIHNldCBzaG93QW1QbUxhYmVsKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2hvd0FtUG1MYWJlbCA9IGNvbnZlcnRUb0Jvb2xQcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJvdGVjdGVkIF9zaG93QW1QbUxhYmVsOiBib29sZWFuID0gdHJ1ZTtcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3Nob3dBbVBtTGFiZWw6IE5iQm9vbGVhbklucHV0O1xuXG4gIC8qKlxuICAgKiBTaG93IHNlY29uZHMgaW4gdGltZXBpY2tlci5cbiAgICogSWdub3JlZCB3aGVuIHNpbmdsZUNvbHVtbiBpcyB0cnVlLlxuICAgKiAqL1xuICBASW5wdXQoKVxuICBnZXQgd2l0aFNlY29uZHMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3dpdGhTZWNvbmRzO1xuICB9XG4gIHNldCB3aXRoU2Vjb25kcyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX3dpdGhTZWNvbmRzID0gY29udmVydFRvQm9vbFByb3BlcnR5KHZhbHVlKTtcbiAgfVxuICBfd2l0aFNlY29uZHM6IGJvb2xlYW47XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV93aXRoU2Vjb25kczogTmJCb29sZWFuSW5wdXQ7XG5cbiAgLyoqXG4gICAqIFNob3cgdGltZXBpY2tlciB2YWx1ZXMgaW4gb25lIGNvbHVtbiB3aXRoIDYwIG1pbnV0ZXMgc3RlcCBieSBkZWZhdWx0LlxuICAgKiAqL1xuICBASW5wdXQoKVxuICBnZXQgc2luZ2xlQ29sdW1uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zaW5nbGVDb2x1bW47XG4gIH1cbiAgc2V0IHNpbmdsZUNvbHVtbih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX3NpbmdsZUNvbHVtbiA9IGNvbnZlcnRUb0Jvb2xQcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgX3NpbmdsZUNvbHVtbjogYm9vbGVhbjtcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3NpbmdsZUNvbHVtbjogTmJCb29sZWFuSW5wdXQ7XG5cbiAgLyoqXG4gICAqIEVtaXRzIGRhdGUgd2l0aCB0aW1lIHdoZW4gc2VsZWN0ZWQuXG4gICAqICovXG4gIEBPdXRwdXQoKSBnZXQgZGF0ZVRpbWVDaGFuZ2UoKTogRXZlbnRFbWl0dGVyPEQ+IHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZUNoYW5nZSBhcyBFdmVudEVtaXR0ZXI8RD47XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KE5CX0RPQ1VNRU5UKSBkb2N1bWVudCxcbiAgICBwb3NpdGlvbkJ1aWxkZXI6IE5iUG9zaXRpb25CdWlsZGVyU2VydmljZSxcbiAgICB0cmlnZ2VyU3RyYXRlZ3lCdWlsZGVyOiBOYlRyaWdnZXJTdHJhdGVneUJ1aWxkZXJTZXJ2aWNlLFxuICAgIG92ZXJsYXk6IE5iT3ZlcmxheVNlcnZpY2UsXG4gICAgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgZGF0ZVNlcnZpY2U6IE5iRGF0ZVNlcnZpY2U8RD4sXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChOQl9EQVRFX1NFUlZJQ0VfT1BUSU9OUykgZGF0ZVNlcnZpY2VPcHRpb25zLFxuICAgIHByb3RlY3RlZCBjYWxlbmRhcldpdGhUaW1lTW9kZWxTZXJ2aWNlOiBOYkNhbGVuZGFyVGltZU1vZGVsU2VydmljZTxEPixcbiAgKSB7XG4gICAgc3VwZXIoZG9jdW1lbnQsIHBvc2l0aW9uQnVpbGRlciwgdHJpZ2dlclN0cmF0ZWd5QnVpbGRlciwgb3ZlcmxheSwgY2ZyLCBkYXRlU2VydmljZSwgZGF0ZVNlcnZpY2VPcHRpb25zKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZm9ybWF0ID0gdGhpcy5mb3JtYXQgfHwgdGhpcy5idWlsZFRpbWVGb3JtYXQoKTtcbiAgICB0aGlzLmluaXQkLm5leHQoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwYXRjaFdpdGhJbnB1dHMoKSB7XG4gICAgdGhpcy5waWNrZXIuc2luZ2xlQ29sdW1uID0gdGhpcy5zaW5nbGVDb2x1bW47XG4gICAgdGhpcy5waWNrZXIudHdlbHZlSG91cnNGb3JtYXQgPSB0aGlzLnR3ZWx2ZUhvdXJzRm9ybWF0O1xuICAgIHRoaXMucGlja2VyLnNob3dBbVBtTGFiZWwgPSB0aGlzLnNob3dBbVBtTGFiZWw7XG4gICAgdGhpcy5waWNrZXIud2l0aFNlY29uZHMgPSB0aGlzLndpdGhTZWNvbmRzO1xuICAgIHRoaXMucGlja2VyLnN0ZXAgPSB0aGlzLnN0ZXA7XG4gICAgdGhpcy5waWNrZXIudGl0bGUgPSB0aGlzLnRpdGxlO1xuICAgIHRoaXMucGlja2VyLmFwcGx5QnV0dG9uVGV4dCA9IHRoaXMuYXBwbHlCdXR0b25UZXh0O1xuICAgIHRoaXMucGlja2VyLmN1cnJlbnRUaW1lQnV0dG9uVGV4dCA9IHRoaXMuY3VycmVudFRpbWVCdXR0b25UZXh0O1xuICAgIHRoaXMucGlja2VyLnNob3dDdXJyZW50VGltZUJ1dHRvbiA9IHRoaXMuc2hvd0N1cnJlbnRUaW1lQnV0dG9uO1xuXG4gICAgaWYgKHRoaXMudHdlbHZlSG91cnNGb3JtYXQpIHtcbiAgICAgIHRoaXMucGlja2VyLnRpbWVGb3JtYXQgPSB0aGlzLmRhdGVTZXJ2aWNlLmdldFR3ZWx2ZUhvdXJzRm9ybWF0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucGlja2VyLnRpbWVGb3JtYXQgPVxuICAgICAgICB0aGlzLndpdGhTZWNvbmRzICYmICF0aGlzLnNpbmdsZUNvbHVtblxuICAgICAgICAgID8gdGhpcy5kYXRlU2VydmljZS5nZXRUd2VudHlGb3VySG91cnNGb3JtYXRXaXRoU2Vjb25kcygpXG4gICAgICAgICAgOiB0aGlzLmRhdGVTZXJ2aWNlLmdldFR3ZW50eUZvdXJIb3Vyc0Zvcm1hdCgpO1xuICAgIH1cbiAgICBzdXBlci5wYXRjaFdpdGhJbnB1dHMoKTtcblxuICAgIHRoaXMucGlja2VyLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldCBwaWNrZXJWYWx1ZUNoYW5nZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnBpY2tlci5kYXRlQ2hhbmdlO1xuICB9XG5cbiAgcHJvdGVjdGVkIHdyaXRlUXVldWUoKSB7XG4gICAgaWYgKHRoaXMucXVldWUpIHtcbiAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLnF1ZXVlO1xuICAgICAgdGhpcy5xdWV1ZSA9IG51bGw7XG4gICAgICB0aGlzLnZhbHVlID0gZGF0ZTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgYnVpbGRUaW1lRm9ybWF0KCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuc2luZ2xlQ29sdW1uKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWxlbmRhcldpdGhUaW1lTW9kZWxTZXJ2aWNlLmJ1aWxkRGF0ZUZvcm1hdCh0aGlzLnR3ZWx2ZUhvdXJzRm9ybWF0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2FsZW5kYXJXaXRoVGltZU1vZGVsU2VydmljZS5idWlsZERhdGVGb3JtYXQodGhpcy50d2VsdmVIb3Vyc0Zvcm1hdCwgdGhpcy53aXRoU2Vjb25kcyk7XG4gICAgfVxuICB9XG59XG4iXX0=