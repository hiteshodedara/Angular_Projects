/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
import { ChangeDetectionStrategy, Component, ContentChildren, EventEmitter, HostBinding, Input, Output, } from '@angular/core';
import { from, merge, Subject } from 'rxjs';
import { debounceTime, filter, startWith, switchMap, takeUntil } from 'rxjs/operators';
import { convertToBoolProperty } from '../helpers';
import { NbButton } from '../button/base-button';
import { NbButtonToggleDirective } from './button-toggle.directive';
import { NB_BUTTON_GROUP } from './button-group-injection-tokens';
import * as i0 from "@angular/core";
import * as i1 from "../../services/status.service";
/**
 * `<nb-button-group>` visually groups buttons together and allow to control buttons properties and the state as a
 * group.
 * @stacked-example(Button Group Showcase, button-group/button-group-showcase.component)
 *
 * ### Installation
 *
 * Import `NbButtonGroupModule` to your feature module.
 * ```ts
 * @NgModule({
 *   imports: [
 *     // ...
 *     NbButtonGroupModule,
 *   ],
 * })
 * export class PageModule { }
 * ```
 *
 * ### Usage
 *
 * You can use `<nb-button-group>` to group a series of `[nbButton]` or `[nbButtonToggle]` components.
 * @stacked-example(Button and Button Toggle Groups, button-group/button-and-button-toggle-groups.component)
 *
 * For a group of multiple `[nbButtonToggle]` you also can control multi-selection behavior. By default, the group
 * component allows only one pressed button toggle at a time (similar to the radio group). To be able to keep multiple
 * toggles pressed, you need to add `multiple` attributes to the `<nb-button-toggle>`.
 * @stacked-example(Button Group Multiple, button-group/button-group-multiple.component)
 *
 * To know which buttons are currently pressed listen to `(valueChange)` on the `nb-button-group`. Event
 * contains an array of values of currently pressed button toggles. You can assign a value to the
 * `[nbButtonToggle]` via the `value` input.
 * @stacked-example(Button Group Value Change, button-group/button-group-value-change.component)
 *
 * To disable a group of buttons, add a `disabled` attribute to the `<nb-button-group>`.
 * @stacked-example(Button Group Disabled, button-group/button-group-disabled.component)
 *
 * The group component controls all visual attributes of buttons such as `appearance`, `status`, `size`, `shape`.
 * You can change it via the appropriate attributes.
 *
 * Button group appearances:
 * @stacked-example(Button Group Appearances, button-group/button-group-appearances.component)
 *
 * Button group statuses:
 * @stacked-example(Button Group Statuses, button-group/button-group-statuses.component)
 *
 * Button group sizes:
 * @stacked-example(Button Group Sizes, button-group/button-group-sizes.component)
 *
 * Buttons group shapes:
 * @additional-example(Button Group Shapes, button-group/button-group-shapes.component)
 *
 * @styles
 *
 * button-group-filled-button-basic-text-color:
 * button-group-filled-button-primary-text-color:
 * button-group-filled-button-success-text-color:
 * button-group-filled-button-info-text-color:
 * button-group-filled-button-warning-text-color:
 * button-group-filled-button-danger-text-color:
 * button-group-filled-button-control-text-color:
 * button-group-filled-basic-divider-color:
 * button-group-filled-primary-divider-color:
 * button-group-filled-success-divider-color:
 * button-group-filled-info-divider-color:
 * button-group-filled-warning-divider-color:
 * button-group-filled-danger-divider-color:
 * button-group-filled-control-divider-color:
 * button-group-ghost-divider-color:
 **/
export class NbButtonGroupComponent {
    get disabled() {
        return this._disabled;
    }
    set disabled(value) {
        if (this.disabled !== convertToBoolProperty(value)) {
            this._disabled = !this.disabled;
        }
    }
    /**
     * Allows to keep multiple button toggles pressed. Off by default.
     */
    get multiple() {
        return this._multiple;
    }
    set multiple(value) {
        this._multiple = convertToBoolProperty(value);
    }
    /**
     * Sets `filled` appearance
     */
    get filled() {
        return this.appearance === 'filled';
    }
    set filled(value) {
        if (convertToBoolProperty(value)) {
            this.appearance = 'filled';
        }
    }
    /**
     * Sets `outline` appearance
     */
    get outline() {
        return this.appearance === 'outline';
    }
    set outline(value) {
        if (convertToBoolProperty(value)) {
            this.appearance = 'outline';
        }
    }
    /**
     * Sets `ghost` appearance
     */
    get ghost() {
        return this.appearance === 'ghost';
    }
    set ghost(value) {
        if (convertToBoolProperty(value)) {
            this.appearance = 'ghost';
        }
    }
    get additionalClasses() {
        if (this.statusService.isCustomStatus(this.status)) {
            return [this.statusService.getStatusClass(this.status)];
        }
        return [];
    }
    constructor(cd, statusService) {
        this.cd = cd;
        this.statusService = statusService;
        this.lastEmittedValue = [];
        this.destroy$ = new Subject();
        this.buttonsChange$ = new Subject();
        /**
         * Button group size, available sizes:
         * `tiny`, `small`, `medium`, `large`, `giant`
         */
        this.size = 'medium';
        /**
         * Button group status (adds specific styles):
         * `basic`, `primary`, `info`, `success`, `warning`, `danger`, `control`
         */
        this.status = 'basic';
        /**
         * Button group shapes: `rectangle`, `round`, `semi-round`
         */
        this.shape = 'rectangle';
        /**
         * Button group appearance: `filled`, `outline`, `ghost`
         */
        this.appearance = 'filled';
        this._disabled = false;
        this._multiple = false;
        /**
         * Emits when `nbButtonToggle` pressed state change. `$event` contains an array of the currently pressed button
         * toggles.
         */
        this.valueChange = new EventEmitter();
        this.role = 'group';
    }
    ngOnChanges({ size, status, shape, multiple, filled, outline, ghost, disabled }) {
        if (size || status || shape || multiple || filled || outline || ghost || disabled) {
            this.syncButtonsProperties(this.buttons?.toArray() || []);
        }
    }
    ngAfterContentInit() {
        this.buttonsChange$.pipe(takeUntil(this.destroy$)).subscribe((buttons) => {
            this.listenButtonPressedState(buttons);
            this.syncButtonsProperties(buttons);
        });
        this.buttons.changes
            .pipe(
        // `buttons.changes` emit during change detection run after projected content already was initialized.
        // So at this time, it's too late to update projected buttons properties as updating bindings after
        // initialization doesn't make sense. Changes won't be picked up and should cause an "expression changed" error.
        // Instead, we wrap the new buttons list into a promise to defer update to the following microtask and also to
        // trigger change detection one more time.
        switchMap((buttons) => from(Promise.resolve(buttons.toArray()))), takeUntil(this.destroy$))
            .subscribe(this.buttonsChange$);
        this.buttonsChange$.next(this.buttons.toArray());
    }
    listenButtonPressedState(buttons) {
        const toggleButtons = buttons.filter((button) => {
            return button instanceof NbButtonToggleDirective;
        });
        if (!toggleButtons.length) {
            return;
        }
        const buttonsPressedChange$ = toggleButtons.map((button) => button.pressedChange$);
        merge(...buttonsPressedChange$)
            .pipe(filter(({ pressed }) => !this.multiple && pressed), takeUntil(merge(this.buttonsChange$, this.destroy$)))
            .subscribe(({ source }) => {
            toggleButtons
                .filter((button) => button !== source)
                .forEach((button) => button._updatePressed(false));
        });
        merge(...buttonsPressedChange$)
            .pipe(
        // Use startWith to emit if some buttons are initially pressed.
        startWith(''), 
        // Use debounce to emit change once when pressed state change in multiple button toggles.
        debounceTime(0), takeUntil(merge(this.buttonsChange$, this.destroy$)))
            .subscribe(() => this.emitCurrentValue(toggleButtons));
    }
    syncButtonsProperties(buttons) {
        buttons.forEach((button) => {
            button.updateProperties({
                appearance: this.appearance,
                size: this.size,
                status: this.status,
                shape: this.shape,
                disabled: this.disabled,
            });
        });
    }
    emitCurrentValue(toggleButtons) {
        const pressedToggleValues = toggleButtons
            .filter((b) => b.pressed && typeof b.value !== 'undefined')
            .map((b) => b.value);
        // Prevent multiple emissions of empty value.
        if (pressedToggleValues.length === 0 && this.lastEmittedValue.length === 0) {
            return;
        }
        this.valueChange.emit(pressedToggleValues);
        this.lastEmittedValue = pressedToggleValues;
    }
}
NbButtonGroupComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbButtonGroupComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.NbStatusService }], target: i0.ɵɵFactoryTarget.Component });
NbButtonGroupComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.4", type: NbButtonGroupComponent, selector: "nb-button-group", inputs: { size: "size", status: "status", shape: "shape", appearance: "appearance", disabled: "disabled", multiple: "multiple", filled: "filled", outline: "outline", ghost: "ghost" }, outputs: { valueChange: "valueChange" }, host: { properties: { "attr.role": "this.role", "class": "this.additionalClasses" } }, providers: [{ provide: NB_BUTTON_GROUP, useExisting: NbButtonGroupComponent }], queries: [{ propertyName: "buttons", predicate: NbButton }], usesOnChanges: true, ngImport: i0, template: ` <ng-content></ng-content> `, isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbButtonGroupComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'nb-button-group',
                    template: ` <ng-content></ng-content> `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [{ provide: NB_BUTTON_GROUP, useExisting: NbButtonGroupComponent }],
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.NbStatusService }]; }, propDecorators: { buttons: [{
                type: ContentChildren,
                args: [NbButton]
            }], size: [{
                type: Input
            }], status: [{
                type: Input
            }], shape: [{
                type: Input
            }], appearance: [{
                type: Input
            }], disabled: [{
                type: Input
            }], multiple: [{
                type: Input
            }], filled: [{
                type: Input
            }], outline: [{
                type: Input
            }], ghost: [{
                type: Input
            }], valueChange: [{
                type: Output
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }], additionalClasses: [{
                type: HostBinding,
                args: ['class']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLWdyb3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvdGhlbWUvY29tcG9uZW50cy9idXR0b24tZ3JvdXAvYnV0dG9uLWdyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUVMLHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsZUFBZSxFQUNmLFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sR0FHUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUd2RixPQUFPLEVBQUUscUJBQXFCLEVBQWtCLE1BQU0sWUFBWSxDQUFDO0FBSW5FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQWtELHVCQUF1QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDcEgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7QUFFbEU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBb0VJO0FBT0osTUFBTSxPQUFPLHNCQUFzQjtJQThCakMsSUFDSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hCLENBQUM7SUFDRCxJQUFJLFFBQVEsQ0FBQyxLQUFjO1FBQ3pCLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNsRCxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFB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LFFBQVE7c0JBRFgsS0FBSztnQkFnQkYsUUFBUTtzQkFEWCxLQUFLO2dCQWNGLE1BQU07c0JBRFQsS0FBSztnQkFlRixPQUFPO3NCQURWLEtBQUs7Z0JBZUYsS0FBSztzQkFEUixLQUFLO2dCQWVJLFdBQVc7c0JBQXBCLE1BQU07Z0JBRW1CLElBQUk7c0JBQTdCLFdBQVc7dUJBQUMsV0FBVztnQkFHcEIsaUJBQWlCO3NCQURwQixXQUFXO3VCQUFDLE9BQU8iLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG5cbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBTaW1wbGVDaGFuZ2VzLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZyb20sIG1lcmdlLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgTmJTdGF0dXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3RhdHVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgY29udmVydFRvQm9vbFByb3BlcnR5LCBOYkJvb2xlYW5JbnB1dCB9IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IHsgTmJDb21wb25lbnRTaXplIH0gZnJvbSAnLi4vY29tcG9uZW50LXNpemUnO1xuaW1wb3J0IHsgTmJDb21wb25lbnRTaGFwZSB9IGZyb20gJy4uL2NvbXBvbmVudC1zaGFwZSc7XG5pbXBvcnQgeyBOYkNvbXBvbmVudE9yQ3VzdG9tU3RhdHVzIH0gZnJvbSAnLi4vY29tcG9uZW50LXN0YXR1cyc7XG5pbXBvcnQgeyBOYkJ1dHRvbiB9IGZyb20gJy4uL2J1dHRvbi9iYXNlLWJ1dHRvbic7XG5pbXBvcnQgeyBOYkJ1dHRvblRvZ2dsZUFwcGVhcmFuY2UsIE5iQnV0dG9uVG9nZ2xlQ2hhbmdlLCBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZSB9IGZyb20gJy4vYnV0dG9uLXRvZ2dsZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTkJfQlVUVE9OX0dST1VQIH0gZnJvbSAnLi9idXR0b24tZ3JvdXAtaW5qZWN0aW9uLXRva2Vucyc7XG5cbi8qKlxuICogYDxuYi1idXR0b24tZ3JvdXA+YCB2aXN1YWxseSBncm91cHMgYnV0dG9ucyB0b2dldGhlciBhbmQgYWxsb3cgdG8gY29udHJvbCBidXR0b25zIHByb3BlcnRpZXMgYW5kIHRoZSBzdGF0ZSBhcyBhXG4gKiBncm91cC5cbiAqIEBzdGFja2VkLWV4YW1wbGUoQnV0dG9uIEdyb3VwIFNob3djYXNlLCBidXR0b24tZ3JvdXAvYnV0dG9uLWdyb3VwLXNob3djYXNlLmNvbXBvbmVudClcbiAqXG4gKiAjIyMgSW5zdGFsbGF0aW9uXG4gKlxuICogSW1wb3J0IGBOYkJ1dHRvbkdyb3VwTW9kdWxlYCB0byB5b3VyIGZlYXR1cmUgbW9kdWxlLlxuICogYGBgdHNcbiAqIEBOZ01vZHVsZSh7XG4gKiAgIGltcG9ydHM6IFtcbiAqICAgICAvLyAuLi5cbiAqICAgICBOYkJ1dHRvbkdyb3VwTW9kdWxlLFxuICogICBdLFxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBQYWdlTW9kdWxlIHsgfVxuICogYGBgXG4gKlxuICogIyMjIFVzYWdlXG4gKlxuICogWW91IGNhbiB1c2UgYDxuYi1idXR0b24tZ3JvdXA+YCB0byBncm91cCBhIHNlcmllcyBvZiBgW25iQnV0dG9uXWAgb3IgYFtuYkJ1dHRvblRvZ2dsZV1gIGNvbXBvbmVudHMuXG4gKiBAc3RhY2tlZC1leGFtcGxlKEJ1dHRvbiBhbmQgQnV0dG9uIFRvZ2dsZSBHcm91cHMsIGJ1dHRvbi1ncm91cC9idXR0b24tYW5kLWJ1dHRvbi10b2dnbGUtZ3JvdXBzLmNvbXBvbmVudClcbiAqXG4gKiBGb3IgYSBncm91cCBvZiBtdWx0aXBsZSBgW25iQnV0dG9uVG9nZ2xlXWAgeW91IGFsc28gY2FuIGNvbnRyb2wgbXVsdGktc2VsZWN0aW9uIGJlaGF2aW9yLiBCeSBkZWZhdWx0LCB0aGUgZ3JvdXBcbiAqIGNvbXBvbmVudCBhbGxvd3Mgb25seSBvbmUgcHJlc3NlZCBidXR0b24gdG9nZ2xlIGF0IGEgdGltZSAoc2ltaWxhciB0byB0aGUgcmFkaW8gZ3JvdXApLiBUbyBiZSBhYmxlIHRvIGtlZXAgbXVsdGlwbGVcbiAqIHRvZ2dsZXMgcHJlc3NlZCwgeW91IG5lZWQgdG8gYWRkIGBtdWx0aXBsZWAgYXR0cmlidXRlcyB0byB0aGUgYDxuYi1idXR0b24tdG9nZ2xlPmAuXG4gKiBAc3RhY2tlZC1leGFtcGxlKEJ1dHRvbiBHcm91cCBNdWx0aXBsZSwgYnV0dG9uLWdyb3VwL2J1dHRvbi1ncm91cC1tdWx0aXBsZS5jb21wb25lbnQpXG4gKlxuICogVG8ga25vdyB3aGljaCBidXR0b25zIGFyZSBjdXJyZW50bHkgcHJlc3NlZCBsaXN0ZW4gdG8gYCh2YWx1ZUNoYW5nZSlgIG9uIHRoZSBgbmItYnV0dG9uLWdyb3VwYC4gRXZlbnRcbiAqIGNvbnRhaW5zIGFuIGFycmF5IG9mIHZhbHVlcyBvZiBjdXJyZW50bHkgcHJlc3NlZCBidXR0b24gdG9nZ2xlcy4gWW91IGNhbiBhc3NpZ24gYSB2YWx1ZSB0byB0aGVcbiAqIGBbbmJCdXR0b25Ub2dnbGVdYCB2aWEgdGhlIGB2YWx1ZWAgaW5wdXQuXG4gKiBAc3RhY2tlZC1leGFtcGxlKEJ1dHRvbiBHcm91cCBWYWx1ZSBDaGFuZ2UsIGJ1dHRvbi1ncm91cC9idXR0b24tZ3JvdXAtdmFsdWUtY2hhbmdlLmNvbXBvbmVudClcbiAqXG4gKiBUbyBkaXNhYmxlIGEgZ3JvdXAgb2YgYnV0dG9ucywgYWRkIGEgYGRpc2FibGVkYCBhdHRyaWJ1dGUgdG8gdGhlIGA8bmItYnV0dG9uLWdyb3VwPmAuXG4gKiBAc3RhY2tlZC1leGFtcGxlKEJ1dHRvbiBHcm91cCBEaXNhYmxlZCwgYnV0dG9uLWdyb3VwL2J1dHRvbi1ncm91cC1kaXNhYmxlZC5jb21wb25lbnQpXG4gKlxuICogVGhlIGdyb3VwIGNvbXBvbmVudCBjb250cm9scyBhbGwgdmlzdWFsIGF0dHJpYnV0ZXMgb2YgYnV0dG9ucyBzdWNoIGFzIGBhcHBlYXJhbmNlYCwgYHN0YXR1c2AsIGBzaXplYCwgYHNoYXBlYC5cbiAqIFlvdSBjYW4gY2hhbmdlIGl0IHZpYSB0aGUgYXBwcm9wcmlhdGUgYXR0cmlidXRlcy5cbiAqXG4gKiBCdXR0b24gZ3JvdXAgYXBwZWFyYW5jZXM6XG4gKiBAc3RhY2tlZC1leGFtcGxlKEJ1dHRvbiBHcm91cCBBcHBlYXJhbmNlcywgYnV0dG9uLWdyb3VwL2J1dHRvbi1ncm91cC1hcHBlYXJhbmNlcy5jb21wb25lbnQpXG4gKlxuICogQnV0dG9uIGdyb3VwIHN0YXR1c2VzOlxuICogQHN0YWNrZWQtZXhhbXBsZShCdXR0b24gR3JvdXAgU3RhdHVzZXMsIGJ1dHRvbi1ncm91cC9idXR0b24tZ3JvdXAtc3RhdHVzZXMuY29tcG9uZW50KVxuICpcbiAqIEJ1dHRvbiBncm91cCBzaXplczpcbiAqIEBzdGFja2VkLWV4YW1wbGUoQnV0dG9uIEdyb3VwIFNpemVzLCBidXR0b24tZ3JvdXAvYnV0dG9uLWdyb3VwLXNpemVzLmNvbXBvbmVudClcbiAqXG4gKiBCdXR0b25zIGdyb3VwIHNoYXBlczpcbiAqIEBhZGRpdGlvbmFsLWV4YW1wbGUoQnV0dG9uIEdyb3VwIFNoYXBlcywgYnV0dG9uLWdyb3VwL2J1dHRvbi1ncm91cC1zaGFwZXMuY29tcG9uZW50KVxuICpcbiAqIEBzdHlsZXNcbiAqXG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLWJ1dHRvbi1iYXNpYy10ZXh0LWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1idXR0b24tcHJpbWFyeS10ZXh0LWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1idXR0b24tc3VjY2Vzcy10ZXh0LWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1idXR0b24taW5mby10ZXh0LWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1idXR0b24td2FybmluZy10ZXh0LWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1idXR0b24tZGFuZ2VyLXRleHQtY29sb3I6XG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLWJ1dHRvbi1jb250cm9sLXRleHQtY29sb3I6XG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLWJhc2ljLWRpdmlkZXItY29sb3I6XG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLXByaW1hcnktZGl2aWRlci1jb2xvcjpcbiAqIGJ1dHRvbi1ncm91cC1maWxsZWQtc3VjY2Vzcy1kaXZpZGVyLWNvbG9yOlxuICogYnV0dG9uLWdyb3VwLWZpbGxlZC1pbmZvLWRpdmlkZXItY29sb3I6XG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLXdhcm5pbmctZGl2aWRlci1jb2xvcjpcbiAqIGJ1dHRvbi1ncm91cC1maWxsZWQtZGFuZ2VyLWRpdmlkZXItY29sb3I6XG4gKiBidXR0b24tZ3JvdXAtZmlsbGVkLWNvbnRyb2wtZGl2aWRlci1jb2xvcjpcbiAqIGJ1dHRvbi1ncm91cC1naG9zdC1kaXZpZGVyLWNvbG9yOlxuICoqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmItYnV0dG9uLWdyb3VwJyxcbiAgdGVtcGxhdGU6IGAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PiBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbeyBwcm92aWRlOiBOQl9CVVRUT05fR1JPVVAsIHVzZUV4aXN0aW5nOiBOYkJ1dHRvbkdyb3VwQ29tcG9uZW50IH1dLFxufSlcbmV4cG9ydCBjbGFzcyBOYkJ1dHRvbkdyb3VwQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlckNvbnRlbnRJbml0IHtcbiAgcHJvdGVjdGVkIGxhc3RFbWl0dGVkVmFsdWU6IGFueVtdID0gW107XG5cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGRlc3Ryb3kkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGJ1dHRvbnNDaGFuZ2UkID0gbmV3IFN1YmplY3Q8TmJCdXR0b25bXT4oKTtcblxuICBAQ29udGVudENoaWxkcmVuKE5iQnV0dG9uKSByZWFkb25seSBidXR0b25zOiBRdWVyeUxpc3Q8TmJCdXR0b24+O1xuXG4gIC8qKlxuICAgKiBCdXR0b24gZ3JvdXAgc2l6ZSwgYXZhaWxhYmxlIHNpemVzOlxuICAgKiBgdGlueWAsIGBzbWFsbGAsIGBtZWRpdW1gLCBgbGFyZ2VgLCBgZ2lhbnRgXG4gICAqL1xuICBASW5wdXQoKSBzaXplOiBOYkNvbXBvbmVudFNpemUgPSAnbWVkaXVtJztcblxuICAvKipcbiAgICogQnV0dG9uIGdyb3VwIHN0YXR1cyAoYWRkcyBzcGVjaWZpYyBzdHlsZXMpOlxuICAgKiBgYmFzaWNgLCBgcHJpbWFyeWAsIGBpbmZvYCwgYHN1Y2Nlc3NgLCBgd2FybmluZ2AsIGBkYW5nZXJgLCBgY29udHJvbGBcbiAgICovXG4gIEBJbnB1dCgpIHN0YXR1czogTmJDb21wb25lbnRPckN1c3RvbVN0YXR1cyA9ICdiYXNpYyc7XG5cbiAgLyoqXG4gICAqIEJ1dHRvbiBncm91cCBzaGFwZXM6IGByZWN0YW5nbGVgLCBgcm91bmRgLCBgc2VtaS1yb3VuZGBcbiAgICovXG4gIEBJbnB1dCgpIHNoYXBlOiBOYkNvbXBvbmVudFNoYXBlID0gJ3JlY3RhbmdsZSc7XG5cbiAgLyoqXG4gICAqIEJ1dHRvbiBncm91cCBhcHBlYXJhbmNlOiBgZmlsbGVkYCwgYG91dGxpbmVgLCBgZ2hvc3RgXG4gICAqL1xuICBASW5wdXQoKSBhcHBlYXJhbmNlOiBOYkJ1dHRvblRvZ2dsZUFwcGVhcmFuY2UgPSAnZmlsbGVkJztcblxuICBASW5wdXQoKVxuICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuICB9XG4gIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLmRpc2FibGVkICE9PSBjb252ZXJ0VG9Cb29sUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICB0aGlzLl9kaXNhYmxlZCA9ICF0aGlzLmRpc2FibGVkO1xuICAgIH1cbiAgfVxuICBwcm90ZWN0ZWQgX2Rpc2FibGVkID0gZmFsc2U7XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9kaXNhYmxlZDogTmJCb29sZWFuSW5wdXQ7XG5cbiAgLyoqXG4gICAqIEFsbG93cyB0byBrZWVwIG11bHRpcGxlIGJ1dHRvbiB0b2dnbGVzIHByZXNzZWQuIE9mZiBieSBkZWZhdWx0LlxuICAgKi9cbiAgQElucHV0KClcbiAgZ2V0IG11bHRpcGxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9tdWx0aXBsZTtcbiAgfVxuICBzZXQgbXVsdGlwbGUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9tdWx0aXBsZSA9IGNvbnZlcnRUb0Jvb2xQcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJvdGVjdGVkIF9tdWx0aXBsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfbXVsdGlwbGU6IE5iQm9vbGVhbklucHV0O1xuXG4gIC8qKlxuICAgKiBTZXRzIGBmaWxsZWRgIGFwcGVhcmFuY2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIGdldCBmaWxsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuYXBwZWFyYW5jZSA9PT0gJ2ZpbGxlZCc7XG4gIH1cbiAgc2V0IGZpbGxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmIChjb252ZXJ0VG9Cb29sUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICB0aGlzLmFwcGVhcmFuY2UgPSAnZmlsbGVkJztcbiAgICB9XG4gIH1cbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2ZpbGxlZDogTmJCb29sZWFuSW5wdXQ7XG5cbiAgLyoqXG4gICAqIFNldHMgYG91dGxpbmVgIGFwcGVhcmFuY2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIGdldCBvdXRsaW5lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmFwcGVhcmFuY2UgPT09ICdvdXRsaW5lJztcbiAgfVxuICBzZXQgb3V0bGluZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmIChjb252ZXJ0VG9Cb29sUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICB0aGlzLmFwcGVhcmFuY2UgPSAnb3V0bGluZSc7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9vdXRsaW5lOiBOYkJvb2xlYW5JbnB1dDtcblxuICAvKipcbiAgICogU2V0cyBgZ2hvc3RgIGFwcGVhcmFuY2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIGdldCBnaG9zdCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5hcHBlYXJhbmNlID09PSAnZ2hvc3QnO1xuICB9XG4gIHNldCBnaG9zdCh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmIChjb252ZXJ0VG9Cb29sUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICB0aGlzLmFwcGVhcmFuY2UgPSAnZ2hvc3QnO1xuICAgIH1cbiAgfVxuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfZ2hvc3Q6IE5iQm9vbGVhbklucHV0O1xuXG4gIC8qKlxuICAgKiBFbWl0cyB3aGVuIGBuYkJ1dHRvblRvZ2dsZWAgcHJlc3NlZCBzdGF0ZSBjaGFuZ2UuIGAkZXZlbnRgIGNvbnRhaW5zIGFuIGFycmF5IG9mIHRoZSBjdXJyZW50bHkgcHJlc3NlZCBidXR0b25cbiAgICogdG9nZ2xlcy5cbiAgICovXG4gIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55W10+KCk7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnJvbGUnKSByb2xlID0gJ2dyb3VwJztcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcbiAgZ2V0IGFkZGl0aW9uYWxDbGFzc2VzKCk6IHN0cmluZ1tdIHtcbiAgICBpZiAodGhpcy5zdGF0dXNTZXJ2aWNlLmlzQ3VzdG9tU3RhdHVzKHRoaXMuc3RhdHVzKSkge1xuICAgICAgcmV0dXJuIFt0aGlzLnN0YXR1c1NlcnZpY2UuZ2V0U3RhdHVzQ2xhc3ModGhpcy5zdGF0dXMpXTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJvdGVjdGVkIHN0YXR1c1NlcnZpY2U6IE5iU3RhdHVzU2VydmljZSkge31cblxuICBuZ09uQ2hhbmdlcyh7IHNpemUsIHN0YXR1cywgc2hhcGUsIG11bHRpcGxlLCBmaWxsZWQsIG91dGxpbmUsIGdob3N0LCBkaXNhYmxlZCB9OiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKHNpemUgfHwgc3RhdHVzIHx8IHNoYXBlIHx8IG11bHRpcGxlIHx8IGZpbGxlZCB8fCBvdXRsaW5lIHx8IGdob3N0IHx8IGRpc2FibGVkKSB7XG4gICAgICB0aGlzLnN5bmNCdXR0b25zUHJvcGVydGllcyh0aGlzLmJ1dHRvbnM/LnRvQXJyYXkoKSB8fCBbXSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYnV0dG9uc0NoYW5nZSQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoYnV0dG9uczogTmJCdXR0b25bXSkgPT4ge1xuICAgICAgdGhpcy5saXN0ZW5CdXR0b25QcmVzc2VkU3RhdGUoYnV0dG9ucyk7XG4gICAgICB0aGlzLnN5bmNCdXR0b25zUHJvcGVydGllcyhidXR0b25zKTtcbiAgICB9KTtcblxuICAgIHRoaXMuYnV0dG9ucy5jaGFuZ2VzXG4gICAgICAucGlwZShcbiAgICAgICAgLy8gYGJ1dHRvbnMuY2hhbmdlc2AgZW1pdCBkdXJpbmcgY2hhbmdlIGRldGVjdGlvbiBydW4gYWZ0ZXIgcHJvamVjdGVkIGNvbnRlbnQgYWxyZWFkeSB3YXMgaW5pdGlhbGl6ZWQuXG4gICAgICAgIC8vIFNvIGF0IHRoaXMgdGltZSwgaXQncyB0b28gbGF0ZSB0byB1cGRhdGUgcHJvamVjdGVkIGJ1dHRvbnMgcHJvcGVydGllcyBhcyB1cGRhdGluZyBiaW5kaW5ncyBhZnRlclxuICAgICAgICAvLyBpbml0aWFsaXphdGlvbiBkb2Vzbid0IG1ha2Ugc2Vuc2UuIENoYW5nZXMgd29uJ3QgYmUgcGlja2VkIHVwIGFuZCBzaG91bGQgY2F1c2UgYW4gXCJleHByZXNzaW9uIGNoYW5nZWRcIiBlcnJvci5cbiAgICAgICAgLy8gSW5zdGVhZCwgd2Ugd3JhcCB0aGUgbmV3IGJ1dHRvbnMgbGlzdCBpbnRvIGEgcHJvbWlzZSB0byBkZWZlciB1cGRhdGUgdG8gdGhlIGZvbGxvd2luZyBtaWNyb3Rhc2sgYW5kIGFsc28gdG9cbiAgICAgICAgLy8gdHJpZ2dlciBjaGFuZ2UgZGV0ZWN0aW9uIG9uZSBtb3JlIHRpbWUuXG4gICAgICAgIHN3aXRjaE1hcCgoYnV0dG9uczogUXVlcnlMaXN0PE5iQnV0dG9uPikgPT4gZnJvbShQcm9taXNlLnJlc29sdmUoYnV0dG9ucy50b0FycmF5KCkpKSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUodGhpcy5idXR0b25zQ2hhbmdlJCk7XG5cbiAgICB0aGlzLmJ1dHRvbnNDaGFuZ2UkLm5leHQodGhpcy5idXR0b25zLnRvQXJyYXkoKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbGlzdGVuQnV0dG9uUHJlc3NlZFN0YXRlKGJ1dHRvbnM6IE5iQnV0dG9uW10pOiB2b2lkIHtcbiAgICBjb25zdCB0b2dnbGVCdXR0b25zOiBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZVtdID0gYnV0dG9ucy5maWx0ZXIoKGJ1dHRvbjogTmJCdXR0b24pID0+IHtcbiAgICAgIHJldHVybiBidXR0b24gaW5zdGFuY2VvZiBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZTtcbiAgICB9KSBhcyBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZVtdO1xuXG4gICAgaWYgKCF0b2dnbGVCdXR0b25zLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1dHRvbnNQcmVzc2VkQ2hhbmdlJDogT2JzZXJ2YWJsZTxOYkJ1dHRvblRvZ2dsZUNoYW5nZT5bXSA9IHRvZ2dsZUJ1dHRvbnMubWFwKFxuICAgICAgKGJ1dHRvbjogTmJCdXR0b25Ub2dnbGVEaXJlY3RpdmUpID0+IGJ1dHRvbi5wcmVzc2VkQ2hhbmdlJCxcbiAgICApO1xuXG4gICAgbWVyZ2UoLi4uYnV0dG9uc1ByZXNzZWRDaGFuZ2UkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoeyBwcmVzc2VkIH06IE5iQnV0dG9uVG9nZ2xlQ2hhbmdlKSA9PiAhdGhpcy5tdWx0aXBsZSAmJiBwcmVzc2VkKSxcbiAgICAgICAgdGFrZVVudGlsKG1lcmdlKHRoaXMuYnV0dG9uc0NoYW5nZSQsIHRoaXMuZGVzdHJveSQpKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKHsgc291cmNlIH06IE5iQnV0dG9uVG9nZ2xlQ2hhbmdlKSA9PiB7XG4gICAgICAgIHRvZ2dsZUJ1dHRvbnNcbiAgICAgICAgICAuZmlsdGVyKChidXR0b246IE5iQnV0dG9uVG9nZ2xlRGlyZWN0aXZlKSA9PiBidXR0b24gIT09IHNvdXJjZSlcbiAgICAgICAgICAuZm9yRWFjaCgoYnV0dG9uOiBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZSkgPT4gYnV0dG9uLl91cGRhdGVQcmVzc2VkKGZhbHNlKSk7XG4gICAgICB9KTtcblxuICAgIG1lcmdlKC4uLmJ1dHRvbnNQcmVzc2VkQ2hhbmdlJClcbiAgICAgIC5waXBlKFxuICAgICAgICAvLyBVc2Ugc3RhcnRXaXRoIHRvIGVtaXQgaWYgc29tZSBidXR0b25zIGFyZSBpbml0aWFsbHkgcHJlc3NlZC5cbiAgICAgICAgc3RhcnRXaXRoKCcnKSxcbiAgICAgICAgLy8gVXNlIGRlYm91bmNlIHRvIGVtaXQgY2hhbmdlIG9uY2Ugd2hlbiBwcmVzc2VkIHN0YXRlIGNoYW5nZSBpbiBtdWx0aXBsZSBidXR0b24gdG9nZ2xlcy5cbiAgICAgICAgZGVib3VuY2VUaW1lKDApLFxuICAgICAgICB0YWtlVW50aWwobWVyZ2UodGhpcy5idXR0b25zQ2hhbmdlJCwgdGhpcy5kZXN0cm95JCkpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmVtaXRDdXJyZW50VmFsdWUodG9nZ2xlQnV0dG9ucykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHN5bmNCdXR0b25zUHJvcGVydGllcyhidXR0b25zOiBOYkJ1dHRvbltdKTogdm9pZCB7XG4gICAgYnV0dG9ucy5mb3JFYWNoKChidXR0b246IE5iQnV0dG9uKSA9PiB7XG4gICAgICBidXR0b24udXBkYXRlUHJvcGVydGllcyh7XG4gICAgICAgIGFwcGVhcmFuY2U6IHRoaXMuYXBwZWFyYW5jZSxcbiAgICAgICAgc2l6ZTogdGhpcy5zaXplLFxuICAgICAgICBzdGF0dXM6IHRoaXMuc3RhdHVzLFxuICAgICAgICBzaGFwZTogdGhpcy5zaGFwZSxcbiAgICAgICAgZGlzYWJsZWQ6IHRoaXMuZGlzYWJsZWQsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBlbWl0Q3VycmVudFZhbHVlKHRvZ2dsZUJ1dHRvbnM6IE5iQnV0dG9uVG9nZ2xlRGlyZWN0aXZlW10pOiB2b2lkIHtcbiAgICBjb25zdCBwcmVzc2VkVG9nZ2xlVmFsdWVzID0gdG9nZ2xlQnV0dG9uc1xuICAgICAgLmZpbHRlcigoYjogTmJCdXR0b25Ub2dnbGVEaXJlY3RpdmUpID0+IGIucHJlc3NlZCAmJiB0eXBlb2YgYi52YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAubWFwKChiOiBOYkJ1dHRvblRvZ2dsZURpcmVjdGl2ZSkgPT4gYi52YWx1ZSk7XG5cbiAgICAvLyBQcmV2ZW50IG11bHRpcGxlIGVtaXNzaW9ucyBvZiBlbXB0eSB2YWx1ZS5cbiAgICBpZiAocHJlc3NlZFRvZ2dsZVZhbHVlcy5sZW5ndGggPT09IDAgJiYgdGhpcy5sYXN0RW1pdHRlZFZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdChwcmVzc2VkVG9nZ2xlVmFsdWVzKTtcbiAgICB0aGlzLmxhc3RFbWl0dGVkVmFsdWUgPSBwcmVzc2VkVG9nZ2xlVmFsdWVzO1xuICB9XG59XG4iXX0=