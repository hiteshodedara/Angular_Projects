/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
import { Directive, Input, Output, EventEmitter, } from '@angular/core';
import { NbDynamicOverlay } from '../cdk/overlay/dynamic/dynamic-overlay';
import { NbDynamicOverlayHandler } from '../cdk/overlay/dynamic/dynamic-overlay-handler';
import { NbAdjustment, NbPosition } from '../cdk/overlay/overlay-position';
import { NbTrigger } from '../cdk/overlay/overlay-trigger';
import { NbPopoverComponent } from './popover.component';
import { takeUntil, skip } from 'rxjs/operators';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "../cdk/overlay/dynamic/dynamic-overlay-handler";
/**
 * Powerful popover directive, which provides the best UX for your users.
 *
 * @stacked-example(Showcase, popover/popover-showcase.component)
 *
 * Popover can accept different content such as:
 * TemplateRef
 *
 * ```html
 * <button [nbPopover]="templateRef"></button>
 * <ng-template #templateRef>
 *   <span>Hello, Popover!</span>
 * </ng-template>
 * ```
 * ### Installation
 *
 * Import `NbPopoverModule` to your feature module.
 * ```ts
 * @NgModule({
 *   imports: [
 *     // ...
 *     NbPopoverModule,
 *   ],
 * })
 * export class PageModule { }
 * ```
 * ### Usage
 *
 * Custom components
 *
 * ```html
 * <button [nbPopover]="MyPopoverComponent"></button>
 * ```
 *
 * Both custom components and templateRef popovers can receive *contentContext* property
 * that will be passed to the content props.
 *
 * Primitive types
 *
 * ```html
 * <button nbPopover="Hello, Popover!"></button>
 * ```
 *
 * Popover has different placements, such as: top, bottom, left, right, start and end
 * which can be used as following:
 *
 * @stacked-example(Placements, popover/popover-placements.component)
 *
 * By default popover will try to adjust itself to maximally fit viewport
 * and provide the best user experience. It will try to change position of the popover container.
 * If you want to disable this behaviour set it `noop`.
 *
 * ```html
 * <button nbPopover="Hello, Popover!" nbPopoverAdjustment="noop"></button>
 * ```
 *
 * Popover has a number of triggers which provides an ability to show and hide the component in different ways:
 *
 * - Click mode shows the component when a user clicks on the host element and hides when the user clicks
 * somewhere on the document outside the component.
 * - Hint provides capability to show the component when the user hovers over the host element
 * and hide when the user hovers out of the host.
 * - Hover works like hint mode with one exception - when the user moves mouse from host element to
 * the container element the component remains open, so that it is possible to interact with it content.
 * - Focus mode is applied when user focuses the element.
 * - Noop mode - the component won't react to the user interaction.
 *
 * @stacked-example(Available Triggers, popover/popover-modes.component.html)
 *
 * Noop mode is especially useful when you need to control Popover programmatically, for example show/hide
 * as a result of some third-party action, like HTTP request or validation check:
 *
 * @stacked-example(Manual Control, popover/popover-noop.component)
 *
 * Below are examples for manual popover settings control, both via template binding and code.
 * @stacked-example(Popover Settings, popover/popover-dynamic.component)
 *
 * Please note, while manipulating Popover setting via code, you need to call `rebuild()` method to apply the settings
 * changed.
 * @stacked-example(Popover Settings Code, popover/popover-dynamic-code.component)
 *
 * @additional-example(Template Ref, popover/popover-template-ref.component)
 * @additional-example(Custom Component, popover/popover-custom-component.component)
 * */
export class NbPopoverDirective {
    /**
     * Container position will be changes automatically based on this strategy if container can't fit view port.
     * Set this property to `noop` value if you want to disable automatically adjustment.
     * Available values: `clockwise` (default), `counterclockwise`, `vertical`, `horizontal`, `noop`.
     * */
    get adjustment() {
        return this._adjustment;
    }
    set adjustment(value) {
        this._adjustment = value;
    }
    get popoverClass() {
        return this._popoverClass;
    }
    set popoverClass(value) {
        if (value !== this.popoverClass) {
            this._popoverClass = value;
            this.overlayConfig = { panelClass: this.popoverClass };
        }
    }
    get isShown() {
        return !!(this.dynamicOverlay && this.dynamicOverlay.isAttached);
    }
    constructor(hostRef, dynamicOverlayHandler) {
        this.hostRef = hostRef;
        this.dynamicOverlayHandler = dynamicOverlayHandler;
        this.popoverComponent = NbPopoverComponent;
        this.destroy$ = new Subject();
        /**
         * Container content context. Will be applied to the rendered component.
         * */
        this.context = {};
        /**
         * Position will be calculated relatively host element based on the position.
         * Can be top, right, bottom, left, start or end.
         * */
        // eslint-disable-next-line @angular-eslint/no-input-rename
        this.position = NbPosition.TOP;
        this._adjustment = NbAdjustment.CLOCKWISE;
        /**
         * Describes when the container will be shown.
         * Available options: `click`, `hover`, `hint`, `focus` and `noop`
         * */
        this.trigger = NbTrigger.CLICK;
        /**
         * Sets popover offset
         * */
        this.offset = 15;
        /** Disables the display of the tooltip. */
        // eslint-disable-next-line @angular-eslint/no-input-rename
        this.disabled = false;
        this._popoverClass = '';
        this.nbPopoverShowStateChange = new EventEmitter();
        this.overlayConfig = { panelClass: this.popoverClass };
    }
    ngOnInit() {
        this.dynamicOverlayHandler.host(this.hostRef).componentType(this.popoverComponent);
    }
    ngOnChanges() {
        this.rebuild();
    }
    ngAfterViewInit() {
        this.dynamicOverlay = this.configureDynamicOverlay().build();
        this.dynamicOverlay.isShown
            .pipe(skip(1), takeUntil(this.destroy$))
            .subscribe((isShown) => this.nbPopoverShowStateChange.emit({ isShown }));
    }
    rebuild() {
        this.dynamicOverlay = this.configureDynamicOverlay().rebuild();
    }
    show() {
        this.dynamicOverlay.show();
    }
    hide() {
        this.dynamicOverlay.hide();
    }
    toggle() {
        this.dynamicOverlay.toggle();
    }
    ngOnDestroy() {
        this.dynamicOverlayHandler.destroy();
        this.destroy$.next();
        this.destroy$.complete();
    }
    configureDynamicOverlay() {
        return this.dynamicOverlayHandler
            .position(this.position)
            .trigger(this.trigger)
            .disabled(this.disabled)
            .offset(this.offset)
            .adjustment(this.adjustment)
            .content(this.content)
            .context(this.context)
            .overlayConfig(this.overlayConfig);
    }
}
NbPopoverDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbPopoverDirective, deps: [{ token: i0.ElementRef }, { token: i1.NbDynamicOverlayHandler }], target: i0.ɵɵFactoryTarget.Directive });
NbPopoverDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.2.4", type: NbPopoverDirective, selector: "[nbPopover]", inputs: { content: ["nbPopover", "content"], context: ["nbPopoverContext", "context"], position: ["nbPopoverPlacement", "position"], adjustment: ["nbPopoverAdjustment", "adjustment"], trigger: ["nbPopoverTrigger", "trigger"], offset: ["nbPopoverOffset", "offset"], disabled: ["nbTooltipDisabled", "disabled"], popoverClass: ["nbPopoverClass", "popoverClass"] }, outputs: { nbPopoverShowStateChange: "nbPopoverShowStateChange" }, providers: [NbDynamicOverlayHandler, NbDynamicOverlay], exportAs: ["nbPopover"], usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbPopoverDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[nbPopover]',
                    exportAs: 'nbPopover',
                    providers: [NbDynamicOverlayHandler, NbDynamicOverlay],
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.NbDynamicOverlayHandler }]; }, propDecorators: { content: [{
                type: Input,
                args: ['nbPopover']
            }], context: [{
                type: Input,
                args: ['nbPopoverContext']
            }], position: [{
                type: Input,
                args: ['nbPopoverPlacement']
            }], adjustment: [{
                type: Input,
                args: ['nbPopoverAdjustment']
            }], trigger: [{
                type: Input,
                args: ['nbPopoverTrigger']
            }], offset: [{
                type: Input,
                args: ['nbPopoverOffset']
            }], disabled: [{
                type: Input,
                args: ['nbTooltipDisabled']
            }], popoverClass: [{
                type: Input,
                args: ['nbPopoverClass']
            }], nbPopoverShowStateChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3RoZW1lL2NvbXBvbmVudHMvcG9wb3Zlci9wb3BvdmVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUVMLFNBQVMsRUFFVCxLQUFLLEVBSUwsTUFBTSxFQUNOLFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQThCLE1BQU0sd0NBQXdDLENBQUM7QUFDdEcsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDekYsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQXdDLE1BQU0saUNBQWlDLENBQUM7QUFFakgsT0FBTyxFQUFFLFNBQVMsRUFBbUIsTUFBTSxnQ0FBZ0MsQ0FBQztBQUU1RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7OztBQUUvQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7S0FtRks7QUFNTCxNQUFNLE9BQU8sa0JBQWtCO0lBMkI3Qjs7OztTQUlLO0lBQ0wsSUFDSSxVQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7SUFDRCxJQUFJLFVBQVUsQ0FBQyxLQUFtQjtRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztJQUMzQixDQUFDO0lBc0JELElBQ0ksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFD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QUFDLFFBQVEsQ0FBQzthQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNyQixRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQzthQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQzthQUNuQixVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQzthQUMzQixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNyQixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNyQixhQUFhLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7OytHQW5JVSxrQkFBa0I7bUdBQWxCLGtCQUFrQixtZEFGbEIsQ0FBQyx1QkFBdUIsRUFBRSxnQkFBZ0IsQ0FBQzsyRkFFM0Msa0JBQWtCO2tCQUw5QixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxhQUFhO29CQUN2QixRQUFRLEVBQUUsV0FBVztvQkFDckIsU0FBUyxFQUFFLENBQUMsdUJBQXVCLEVBQUUsZ0JBQWdCLENBQUM7aUJBQ3ZEO3VJQVdDLE9BQU87c0JBRE4sS0FBSzt1QkFBQyxXQUFXO2dCQU9sQixPQUFPO3NCQUROLEtBQUs7dUJBQUMsa0JBQWtCO2dCQVN6QixRQUFRO3NCQURQLEtBQUs7dUJBQUMsb0JBQW9CO2dCQVV2QixVQUFVO3NCQURiLEtBQUs7dUJBQUMscUJBQXFCO2dCQWU1QixPQUFPO3NCQUROLEtBQUs7dUJBQUMsa0JBQWtCO2dCQVF6QixNQUFNO3NCQURMLEtBQUs7dUJBQUMsaUJBQWlCO2dCQUtJLFFBQVE7c0JBQW5DLEtBQUs7dUJBQUMsbUJBQW1CO2dCQUd0QixZQUFZO3NCQURmLEtBQUs7dUJBQUMsZ0JBQWdCO2dCQWF2Qix3QkFBd0I7c0JBRHZCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG5cbmltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgTmJEeW5hbWljT3ZlcmxheSwgTmJEeW5hbWljT3ZlcmxheUNvbnRyb2xsZXIgfSBmcm9tICcuLi9jZGsvb3ZlcmxheS9keW5hbWljL2R5bmFtaWMtb3ZlcmxheSc7XG5pbXBvcnQgeyBOYkR5bmFtaWNPdmVybGF5SGFuZGxlciB9IGZyb20gJy4uL2Nkay9vdmVybGF5L2R5bmFtaWMvZHluYW1pYy1vdmVybGF5LWhhbmRsZXInO1xuaW1wb3J0IHsgTmJBZGp1c3RtZW50LCBOYlBvc2l0aW9uLCBOYlBvc2l0aW9uVmFsdWVzLCBOYkFkanVzdG1lbnRWYWx1ZXMgfSBmcm9tICcuLi9jZGsvb3ZlcmxheS9vdmVybGF5LXBvc2l0aW9uJztcbmltcG9ydCB7IE5iT3ZlcmxheUNvbnRlbnQgfSBmcm9tICcuLi9jZGsvb3ZlcmxheS9vdmVybGF5LXNlcnZpY2UnO1xuaW1wb3J0IHsgTmJUcmlnZ2VyLCBOYlRyaWdnZXJWYWx1ZXMgfSBmcm9tICcuLi9jZGsvb3ZlcmxheS9vdmVybGF5LXRyaWdnZXInO1xuaW1wb3J0IHsgTmJPdmVybGF5Q29uZmlnIH0gZnJvbSAnLi4vY2RrL292ZXJsYXkvbWFwcGluZyc7XG5pbXBvcnQgeyBOYlBvcG92ZXJDb21wb25lbnQgfSBmcm9tICcuL3BvcG92ZXIuY29tcG9uZW50JztcbmltcG9ydCB7IHRha2VVbnRpbCwgc2tpcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuLyoqXG4gKiBQb3dlcmZ1bCBwb3BvdmVyIGRpcmVjdGl2ZSwgd2hpY2ggcHJvdmlkZXMgdGhlIGJlc3QgVVggZm9yIHlvdXIgdXNlcnMuXG4gKlxuICogQHN0YWNrZWQtZXhhbXBsZShTaG93Y2FzZSwgcG9wb3Zlci9wb3BvdmVyLXNob3djYXNlLmNvbXBvbmVudClcbiAqXG4gKiBQb3BvdmVyIGNhbiBhY2NlcHQgZGlmZmVyZW50IGNvbnRlbnQgc3VjaCBhczpcbiAqIFRlbXBsYXRlUmVmXG4gKlxuICogYGBgaHRtbFxuICogPGJ1dHRvbiBbbmJQb3BvdmVyXT1cInRlbXBsYXRlUmVmXCI+PC9idXR0b24+XG4gKiA8bmctdGVtcGxhdGUgI3RlbXBsYXRlUmVmPlxuICogICA8c3Bhbj5IZWxsbywgUG9wb3ZlciE8L3NwYW4+XG4gKiA8L25nLXRlbXBsYXRlPlxuICogYGBgXG4gKiAjIyMgSW5zdGFsbGF0aW9uXG4gKlxuICogSW1wb3J0IGBOYlBvcG92ZXJNb2R1bGVgIHRvIHlvdXIgZmVhdHVyZSBtb2R1bGUuXG4gKiBgYGB0c1xuICogQE5nTW9kdWxlKHtcbiAqICAgaW1wb3J0czogW1xuICogICAgIC8vIC4uLlxuICogICAgIE5iUG9wb3Zlck1vZHVsZSxcbiAqICAgXSxcbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgUGFnZU1vZHVsZSB7IH1cbiAqIGBgYFxuICogIyMjIFVzYWdlXG4gKlxuICogQ3VzdG9tIGNvbXBvbmVudHNcbiAqXG4gKiBgYGBodG1sXG4gKiA8YnV0dG9uIFtuYlBvcG92ZXJdPVwiTXlQb3BvdmVyQ29tcG9uZW50XCI+PC9idXR0b24+XG4gKiBgYGBcbiAqXG4gKiBCb3RoIGN1c3RvbSBjb21wb25lbnRzIGFuZCB0ZW1wbGF0ZVJlZiBwb3BvdmVycyBjYW4gcmVjZWl2ZSAqY29udGVudENvbnRleHQqIHByb3BlcnR5XG4gKiB0aGF0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjb250ZW50IHByb3BzLlxuICpcbiAqIFByaW1pdGl2ZSB0eXBlc1xuICpcbiAqIGBgYGh0bWxcbiAqIDxidXR0b24gbmJQb3BvdmVyPVwiSGVsbG8sIFBvcG92ZXIhXCI+PC9idXR0b24+XG4gKiBgYGBcbiAqXG4gKiBQb3BvdmVyIGhhcyBkaWZmZXJlbnQgcGxhY2VtZW50cywgc3VjaCBhczogdG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0LCBzdGFydCBhbmQgZW5kXG4gKiB3aGljaCBjYW4gYmUgdXNlZCBhcyBmb2xsb3dpbmc6XG4gKlxuICogQHN0YWNrZWQtZXhhbXBsZShQbGFjZW1lbnRzLCBwb3BvdmVyL3BvcG92ZXItcGxhY2VtZW50cy5jb21wb25lbnQpXG4gKlxuICogQnkgZGVmYXVsdCBwb3BvdmVyIHdpbGwgdHJ5IHRvIGFkanVzdCBpdHNlbGYgdG8gbWF4aW1hbGx5IGZpdCB2aWV3cG9ydFxuICogYW5kIHByb3ZpZGUgdGhlIGJlc3QgdXNlciBleHBlcmllbmNlLiBJdCB3aWxsIHRyeSB0byBjaGFuZ2UgcG9zaXRpb24gb2YgdGhlIHBvcG92ZXIgY29udGFpbmVyLlxuICogSWYgeW91IHdhbnQgdG8gZGlzYWJsZSB0aGlzIGJlaGF2aW91ciBzZXQgaXQgYG5vb3BgLlxuICpcbiAqIGBgYGh0bWxcbiAqIDxidXR0b24gbmJQb3BvdmVyPVwiSGVsbG8sIFBvcG92ZXIhXCIgbmJQb3BvdmVyQWRqdXN0bWVudD1cIm5vb3BcIj48L2J1dHRvbj5cbiAqIGBgYFxuICpcbiAqIFBvcG92ZXIgaGFzIGEgbnVtYmVyIG9mIHRyaWdnZXJzIHdoaWNoIHByb3ZpZGVzIGFuIGFiaWxpdHkgdG8gc2hvdyBhbmQgaGlkZSB0aGUgY29tcG9uZW50IGluIGRpZmZlcmVudCB3YXlzOlxuICpcbiAqIC0gQ2xpY2sgbW9kZSBzaG93cyB0aGUgY29tcG9uZW50IHdoZW4gYSB1c2VyIGNsaWNrcyBvbiB0aGUgaG9zdCBlbGVtZW50IGFuZCBoaWRlcyB3aGVuIHRoZSB1c2VyIGNsaWNrc1xuICogc29tZXdoZXJlIG9uIHRoZSBkb2N1bWVudCBvdXRzaWRlIHRoZSBjb21wb25lbnQuXG4gKiAtIEhpbnQgcHJvdmlkZXMgY2FwYWJpbGl0eSB0byBzaG93IHRoZSBjb21wb25lbnQgd2hlbiB0aGUgdXNlciBob3ZlcnMgb3ZlciB0aGUgaG9zdCBlbGVtZW50XG4gKiBhbmQgaGlkZSB3aGVuIHRoZSB1c2VyIGhvdmVycyBvdXQgb2YgdGhlIGhvc3QuXG4gKiAtIEhvdmVyIHdvcmtzIGxpa2UgaGludCBtb2RlIHdpdGggb25lIGV4Y2VwdGlvbiAtIHdoZW4gdGhlIHVzZXIgbW92ZXMgbW91c2UgZnJvbSBob3N0IGVsZW1lbnQgdG9cbiAqIHRoZSBjb250YWluZXIgZWxlbWVudCB0aGUgY29tcG9uZW50IHJlbWFpbnMgb3Blbiwgc28gdGhhdCBpdCBpcyBwb3NzaWJsZSB0byBpbnRlcmFjdCB3aXRoIGl0IGNvbnRlbnQuXG4gKiAtIEZvY3VzIG1vZGUgaXMgYXBwbGllZCB3aGVuIHVzZXIgZm9jdXNlcyB0aGUgZWxlbWVudC5cbiAqIC0gTm9vcCBtb2RlIC0gdGhlIGNvbXBvbmVudCB3b24ndCByZWFjdCB0byB0aGUgdXNlciBpbnRlcmFjdGlvbi5cbiAqXG4gKiBAc3RhY2tlZC1leGFtcGxlKEF2YWlsYWJsZSBUcmlnZ2VycywgcG9wb3Zlci9wb3BvdmVyLW1vZGVzLmNvbXBvbmVudC5odG1sKVxuICpcbiAqIE5vb3AgbW9kZSBpcyBlc3BlY2lhbGx5IHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIGNvbnRyb2wgUG9wb3ZlciBwcm9ncmFtbWF0aWNhbGx5LCBmb3IgZXhhbXBsZSBzaG93L2hpZGVcbiAqIGFzIGEgcmVzdWx0IG9mIHNvbWUgdGhpcmQtcGFydHkgYWN0aW9uLCBsaWtlIEhUVFAgcmVxdWVzdCBvciB2YWxpZGF0aW9uIGNoZWNrOlxuICpcbiAqIEBzdGFja2VkLWV4YW1wbGUoTWFudWFsIENvbnRyb2wsIHBvcG92ZXIvcG9wb3Zlci1ub29wLmNvbXBvbmVudClcbiAqXG4gKiBCZWxvdyBhcmUgZXhhbXBsZXMgZm9yIG1hbnVhbCBwb3BvdmVyIHNldHRpbmdzIGNvbnRyb2wsIGJvdGggdmlhIHRlbXBsYXRlIGJpbmRpbmcgYW5kIGNvZGUuXG4gKiBAc3RhY2tlZC1leGFtcGxlKFBvcG92ZXIgU2V0dGluZ3MsIHBvcG92ZXIvcG9wb3Zlci1keW5hbWljLmNvbXBvbmVudClcbiAqXG4gKiBQbGVhc2Ugbm90ZSwgd2hpbGUgbWFuaXB1bGF0aW5nIFBvcG92ZXIgc2V0dGluZyB2aWEgY29kZSwgeW91IG5lZWQgdG8gY2FsbCBgcmVidWlsZCgpYCBtZXRob2QgdG8gYXBwbHkgdGhlIHNldHRpbmdzXG4gKiBjaGFuZ2VkLlxuICogQHN0YWNrZWQtZXhhbXBsZShQb3BvdmVyIFNldHRpbmdzIENvZGUsIHBvcG92ZXIvcG9wb3Zlci1keW5hbWljLWNvZGUuY29tcG9uZW50KVxuICpcbiAqIEBhZGRpdGlvbmFsLWV4YW1wbGUoVGVtcGxhdGUgUmVmLCBwb3BvdmVyL3BvcG92ZXItdGVtcGxhdGUtcmVmLmNvbXBvbmVudClcbiAqIEBhZGRpdGlvbmFsLWV4YW1wbGUoQ3VzdG9tIENvbXBvbmVudCwgcG9wb3Zlci9wb3BvdmVyLWN1c3RvbS1jb21wb25lbnQuY29tcG9uZW50KVxuICogKi9cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tuYlBvcG92ZXJdJyxcbiAgZXhwb3J0QXM6ICduYlBvcG92ZXInLFxuICBwcm92aWRlcnM6IFtOYkR5bmFtaWNPdmVybGF5SGFuZGxlciwgTmJEeW5hbWljT3ZlcmxheV0sXG59KVxuZXhwb3J0IGNsYXNzIE5iUG9wb3ZlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE5iRHluYW1pY092ZXJsYXlDb250cm9sbGVyLCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25Jbml0IHtcbiAgcHJvdGVjdGVkIHBvcG92ZXJDb21wb25lbnQgPSBOYlBvcG92ZXJDb21wb25lbnQ7XG4gIHByb3RlY3RlZCBkeW5hbWljT3ZlcmxheTogTmJEeW5hbWljT3ZlcmxheTtcbiAgcHJvdGVjdGVkIGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAvKipcbiAgICogUG9wb3ZlciBjb250ZW50IHdoaWNoIHdpbGwgYmUgcmVuZGVyZWQgaW4gTmJBcnJvd2VkT3ZlcmxheUNvbnRhaW5lckNvbXBvbmVudC5cbiAgICogQXZhaWxhYmxlIGNvbnRlbnQ6IHRlbXBsYXRlIHJlZiwgY29tcG9uZW50IGFuZCBhbnkgcHJpbWl0aXZlLlxuICAgKiAqL1xuICBASW5wdXQoJ25iUG9wb3ZlcicpXG4gIGNvbnRlbnQ6IE5iT3ZlcmxheUNvbnRlbnQ7XG5cbiAgLyoqXG4gICAqIENvbnRhaW5lciBjb250ZW50IGNvbnRleHQuIFdpbGwgYmUgYXBwbGllZCB0byB0aGUgcmVuZGVyZWQgY29tcG9uZW50LlxuICAgKiAqL1xuICBASW5wdXQoJ25iUG9wb3ZlckNvbnRleHQnKVxuICBjb250ZXh0OiBPYmplY3QgPSB7fTtcblxuICAvKipcbiAgICogUG9zaXRpb24gd2lsbCBiZSBjYWxjdWxhdGVkIHJlbGF0aXZlbHkgaG9zdCBlbGVtZW50IGJhc2VkIG9uIHRoZSBwb3NpdGlvbi5cbiAgICogQ2FuIGJlIHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCwgc3RhcnQgb3IgZW5kLlxuICAgKiAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLWlucHV0LXJlbmFtZVxuICBASW5wdXQoJ25iUG9wb3ZlclBsYWNlbWVudCcpXG4gIHBvc2l0aW9uOiBOYlBvc2l0aW9uID0gTmJQb3NpdGlvbi5UT1A7XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9wb3NpdGlvbjogTmJQb3NpdGlvblZhbHVlcztcblxuICAvKipcbiAgICogQ29udGFpbmVyIHBvc2l0aW9uIHdpbGwgYmUgY2hhbmdlcyBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHRoaXMgc3RyYXRlZ3kgaWYgY29udGFpbmVyIGNhbid0IGZpdCB2aWV3IHBvcnQuXG4gICAqIFNldCB0aGlzIHByb3BlcnR5IHRvIGBub29wYCB2YWx1ZSBpZiB5b3Ugd2FudCB0byBkaXNhYmxlIGF1dG9tYXRpY2FsbHkgYWRqdXN0bWVudC5cbiAgICogQXZhaWxhYmxlIHZhbHVlczogYGNsb2Nrd2lzZWAgKGRlZmF1bHQpLCBgY291bnRlcmNsb2Nrd2lzZWAsIGB2ZXJ0aWNhbGAsIGBob3Jpem9udGFsYCwgYG5vb3BgLlxuICAgKiAqL1xuICBASW5wdXQoJ25iUG9wb3ZlckFkanVzdG1lbnQnKVxuICBnZXQgYWRqdXN0bWVudCgpOiBOYkFkanVzdG1lbnQge1xuICAgIHJldHVybiB0aGlzLl9hZGp1c3RtZW50O1xuICB9XG4gIHNldCBhZGp1c3RtZW50KHZhbHVlOiBOYkFkanVzdG1lbnQpIHtcbiAgICB0aGlzLl9hZGp1c3RtZW50ID0gdmFsdWU7XG4gIH1cbiAgcHJvdGVjdGVkIF9hZGp1c3RtZW50OiBOYkFkanVzdG1lbnQgPSBOYkFkanVzdG1lbnQuQ0xPQ0tXSVNFO1xuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfYWRqdXN0bWVudDogTmJBZGp1c3RtZW50VmFsdWVzO1xuXG4gIC8qKlxuICAgKiBEZXNjcmliZXMgd2hlbiB0aGUgY29udGFpbmVyIHdpbGwgYmUgc2hvd24uXG4gICAqIEF2YWlsYWJsZSBvcHRpb25zOiBgY2xpY2tgLCBgaG92ZXJgLCBgaGludGAsIGBmb2N1c2AgYW5kIGBub29wYFxuICAgKiAqL1xuICBASW5wdXQoJ25iUG9wb3ZlclRyaWdnZXInKVxuICB0cmlnZ2VyOiBOYlRyaWdnZXIgPSBOYlRyaWdnZXIuQ0xJQ0s7XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV90cmlnZ2VyOiBOYlRyaWdnZXJWYWx1ZXM7XG5cbiAgLyoqXG4gICAqIFNldHMgcG9wb3ZlciBvZmZzZXRcbiAgICogKi9cbiAgQElucHV0KCduYlBvcG92ZXJPZmZzZXQnKVxuICBvZmZzZXQgPSAxNTtcblxuICAvKiogRGlzYWJsZXMgdGhlIGRpc3BsYXkgb2YgdGhlIHRvb2x0aXAuICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8taW5wdXQtcmVuYW1lXG4gIEBJbnB1dCgnbmJUb29sdGlwRGlzYWJsZWQnKSBkaXNhYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgnbmJQb3BvdmVyQ2xhc3MnKVxuICBnZXQgcG9wb3ZlckNsYXNzKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3BvcG92ZXJDbGFzcztcbiAgfVxuICBzZXQgcG9wb3ZlckNsYXNzKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAodmFsdWUgIT09IHRoaXMucG9wb3ZlckNsYXNzKSB7XG4gICAgICB0aGlzLl9wb3BvdmVyQ2xhc3MgPSB2YWx1ZTtcbiAgICAgIHRoaXMub3ZlcmxheUNvbmZpZyA9IHsgcGFuZWxDbGFzczogdGhpcy5wb3BvdmVyQ2xhc3MgfTtcbiAgICB9XG4gIH1cbiAgX3BvcG92ZXJDbGFzczogc3RyaW5nID0gJyc7XG5cbiAgQE91dHB1dCgpXG4gIG5iUG9wb3ZlclNob3dTdGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8eyBpc1Nob3duOiBib29sZWFuIH0+KCk7XG5cbiAgcHJvdGVjdGVkIG92ZXJsYXlDb25maWc6IE5iT3ZlcmxheUNvbmZpZyA9IHsgcGFuZWxDbGFzczogdGhpcy5wb3BvdmVyQ2xhc3MgfTtcblxuICBnZXQgaXNTaG93bigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEodGhpcy5keW5hbWljT3ZlcmxheSAmJiB0aGlzLmR5bmFtaWNPdmVybGF5LmlzQXR0YWNoZWQpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGhvc3RSZWY6IEVsZW1lbnRSZWYsIHByb3RlY3RlZCBkeW5hbWljT3ZlcmxheUhhbmRsZXI6IE5iRHluYW1pY092ZXJsYXlIYW5kbGVyKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZHluYW1pY092ZXJsYXlIYW5kbGVyLmhvc3QodGhpcy5ob3N0UmVmKS5jb21wb25lbnRUeXBlKHRoaXMucG9wb3ZlckNvbXBvbmVudCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICB0aGlzLnJlYnVpbGQoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmR5bmFtaWNPdmVybGF5ID0gdGhpcy5jb25maWd1cmVEeW5hbWljT3ZlcmxheSgpLmJ1aWxkKCk7XG5cbiAgICB0aGlzLmR5bmFtaWNPdmVybGF5LmlzU2hvd25cbiAgICAgIC5waXBlKHNraXAoMSksIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKGlzU2hvd246IGJvb2xlYW4pID0+IHRoaXMubmJQb3BvdmVyU2hvd1N0YXRlQ2hhbmdlLmVtaXQoeyBpc1Nob3duIH0pKTtcbiAgfVxuXG4gIHJlYnVpbGQoKSB7XG4gICAgdGhpcy5keW5hbWljT3ZlcmxheSA9IHRoaXMuY29uZmlndXJlRHluYW1pY092ZXJsYXkoKS5yZWJ1aWxkKCk7XG4gIH1cblxuICBzaG93KCkge1xuICAgIHRoaXMuZHluYW1pY092ZXJsYXkuc2hvdygpO1xuICB9XG5cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmR5bmFtaWNPdmVybGF5LmhpZGUoKTtcbiAgfVxuXG4gIHRvZ2dsZSgpIHtcbiAgICB0aGlzLmR5bmFtaWNPdmVybGF5LnRvZ2dsZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5keW5hbWljT3ZlcmxheUhhbmRsZXIuZGVzdHJveSgpO1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjb25maWd1cmVEeW5hbWljT3ZlcmxheSgpIHtcbiAgICByZXR1cm4gdGhpcy5keW5hbWljT3ZlcmxheUhhbmRsZXJcbiAgICAgIC5wb3NpdGlvbih0aGlzLnBvc2l0aW9uKVxuICAgICAgLnRyaWdnZXIodGhpcy50cmlnZ2VyKVxuICAgICAgLmRpc2FibGVkKHRoaXMuZGlzYWJsZWQpXG4gICAgICAub2Zmc2V0KHRoaXMub2Zmc2V0KVxuICAgICAgLmFkanVzdG1lbnQodGhpcy5hZGp1c3RtZW50KVxuICAgICAgLmNvbnRlbnQodGhpcy5jb250ZW50KVxuICAgICAgLmNvbnRleHQodGhpcy5jb250ZXh0KVxuICAgICAgLm92ZXJsYXlDb25maWcodGhpcy5vdmVybGF5Q29uZmlnKTtcbiAgfVxufVxuIl19