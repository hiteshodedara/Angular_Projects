import { Inject, Injectable } from '@angular/core';
import { GlobalPositionStrategy } from '@angular/cdk/overlay';
import { map } from 'rxjs/operators';
import { NB_DOCUMENT } from '../../../theme.options';
import { NbFlexibleConnectedPositionStrategy, } from './mapping';
import { NbGlobalLogicalPosition } from './position-helper';
import { NbLayoutDirection } from '../../../services/direction.service';
import * as i0 from "@angular/core";
import * as i1 from "../adapter/viewport-ruler-adapter";
import * as i2 from "../platform/platform-service";
import * as i3 from "./mapping";
import * as i4 from "../adapter/overlay-container-adapter";
export var NbAdjustment;
(function (NbAdjustment) {
    NbAdjustment["NOOP"] = "noop";
    NbAdjustment["CLOCKWISE"] = "clockwise";
    NbAdjustment["COUNTERCLOCKWISE"] = "counterclockwise";
    NbAdjustment["VERTICAL"] = "vertical";
    NbAdjustment["HORIZONTAL"] = "horizontal";
})(NbAdjustment || (NbAdjustment = {}));
export var NbPosition;
(function (NbPosition) {
    NbPosition["TOP"] = "top";
    NbPosition["BOTTOM"] = "bottom";
    NbPosition["LEFT"] = "left";
    NbPosition["RIGHT"] = "right";
    NbPosition["START"] = "start";
    NbPosition["END"] = "end";
    NbPosition["TOP_END"] = "top-end";
    NbPosition["TOP_START"] = "top-start";
    NbPosition["BOTTOM_END"] = "bottom-end";
    NbPosition["BOTTOM_START"] = "bottom-start";
    NbPosition["END_TOP"] = "end-top";
    NbPosition["END_BOTTOM"] = "end-bottom";
    NbPosition["START_TOP"] = "start-top";
    NbPosition["START_BOTTOM"] = "start-bottom";
})(NbPosition || (NbPosition = {}));
const POSITIONS = {
    [NbPosition.RIGHT](offset) {
        return { originX: 'end', originY: 'center', overlayX: 'start', overlayY: 'center', offsetX: offset };
    },
    [NbPosition.BOTTOM](offset) {
        return { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: offset };
    },
    [NbPosition.LEFT](offset) {
        return { originX: 'start', originY: 'center', overlayX: 'end', overlayY: 'center', offsetX: -offset };
    },
    [NbPosition.TOP](offset) {
        return { originX: 'center', originY: 'top', overlayX: 'center', overlayY: 'bottom', offsetY: -offset };
    },
    [NbPosition.START](offset) {
        return this[NbPosition.LEFT](offset);
    },
    [NbPosition.END](offset) {
        return this[NbPosition.RIGHT](offset);
    },
    [NbPosition.END_TOP](offset) {
        return { originX: 'end', originY: 'bottom', overlayX: 'start', overlayY: 'bottom', offsetX: offset };
    },
    [NbPosition.END_BOTTOM](offset) {
        return { originX: 'end', originY: 'top', overlayX: 'start', overlayY: 'top', offsetX: offset };
    },
    [NbPosition.BOTTOM_START](offset) {
        return { originX: 'end', originY: 'bottom', overlayX: 'end', overlayY: 'top', offsetY: offset };
    },
    [NbPosition.BOTTOM_END](offset) {
        return { originX: 'start', originY: 'bottom', overlayX: 'start', overlayY: 'top', offsetY: offset };
    },
    [NbPosition.START_TOP](offset) {
        return { originX: 'start', originY: 'bottom', overlayX: 'end', overlayY: 'bottom', offsetX: -offset };
    },
    [NbPosition.START_BOTTOM](offset) {
        return { originX: 'start', originY: 'top', overlayX: 'end', overlayY: 'top', offsetX: -offset };
    },
    [NbPosition.TOP_START](offset) {
        return { originX: 'end', originY: 'top', overlayX: 'end', overlayY: 'bottom', offsetY: -offset };
    },
    [NbPosition.TOP_END](offset) {
        return { originX: 'start', originY: 'top', overlayX: 'start', overlayY: 'bottom', offsetY: -offset };
    },
};
const RTL_PHYSICAL_POSITIONS = {
    ...POSITIONS,
    [NbPosition.RIGHT](offset) {
        return { originX: 'start', originY: 'center', overlayX: 'end', overlayY: 'center', offsetX: offset };
    },
    [NbPosition.LEFT](offset) {
        return { originX: 'end', originY: 'center', overlayX: 'start', overlayY: 'center', offsetX: -offset };
    },
    [NbPosition.START](offset) {
        return this[NbPosition.RIGHT](offset);
    },
    [NbPosition.END](offset) {
        return this[NbPosition.LEFT](offset);
    },
};
const COUNTER_CLOCKWISE_POSITIONS = [
    NbPosition.TOP,
    NbPosition.TOP_END,
    NbPosition.TOP_START,
    NbPosition.START,
    NbPosition.START_TOP,
    NbPosition.START_BOTTOM,
    NbPosition.BOTTOM,
    NbPosition.BOTTOM_START,
    NbPosition.BOTTOM_END,
    NbPosition.END,
    NbPosition.END_BOTTOM,
    NbPosition.END_TOP,
];
const CLOCKWISE_POSITIONS = [
    NbPosition.TOP,
    NbPosition.TOP_START,
    NbPosition.TOP_END,
    NbPosition.END,
    NbPosition.END_TOP,
    NbPosition.END_BOTTOM,
    NbPosition.BOTTOM,
    NbPosition.BOTTOM_END,
    NbPosition.BOTTOM_START,
    NbPosition.START,
    NbPosition.START_BOTTOM,
    NbPosition.START_TOP,
];
const VERTICAL_POSITIONS = [NbPosition.BOTTOM, NbPosition.TOP];
const HORIZONTAL_POSITIONS = [NbPosition.START, NbPosition.END];
function comparePositions(p1, p2) {
    return (p1.originX === p2.originX && p1.originY === p2.originY && p1.overlayX === p2.overlayX && p1.overlayY === p2.overlayY);
}
/**
 * The main idea of the adjustable connected strategy is to provide predefined set of positions for your overlay.
 * You have to provide adjustment and appropriate strategy will be chosen in runtime.
 * */
export class NbAdjustableConnectedPositionStrategy extends NbFlexibleConnectedPositionStrategy {
    constructor() {
        super(...arguments);
        this._offset = 15;
        this.positionChange = this.positionChanges.pipe(map((positionChange) => positionChange.connectionPair), map((connectionPair) => {
            return this.appliedPositions.find(({ connectedPosition }) => {
                return comparePositions(connectedPosition, connectionPair);
            }).key;
        }));
    }
    attach(overlayRef) {
        /**
         * We have to apply positions before attach because super.attach() validates positions and crashes app
         * if no positions provided.
         * */
        this.applyPositions();
        super.attach(overlayRef);
    }
    direction(direction) {
        this._direction = direction;
        return this;
    }
    apply() {
        this.applyPositions();
        super.apply();
    }
    position(position) {
        this._position = position;
        return this;
    }
    adjustment(adjustment) {
        this._adjustment = adjustment;
        return this;
    }
    offset(offset) {
        this._offset = offset;
        return this;
    }
    applyPositions() {
        const positions = this.createPositions();
        this.persistChosenPositions(positions);
        this.withPositions(this.appliedPositions.map(({ connectedPosition }) => connectedPosition));
    }
    createPositions() {
        switch (this._adjustment) {
            case NbAdjustment.NOOP:
                return [this._position];
            case NbAdjustment.CLOCKWISE:
                return this.reorderPreferredPositions(CLOCKWISE_POSITIONS);
            case NbAdjustment.COUNTERCLOCKWISE:
                return this.reorderPreferredPositions(COUNTER_CLOCKWISE_POSITIONS);
            case NbAdjustment.HORIZONTAL:
                return this.reorderPreferredPositions(HORIZONTAL_POSITIONS);
            case NbAdjustment.VERTICAL:
                return this.reorderPreferredPositions(VERTICAL_POSITIONS);
        }
    }
    mapToLogicalPosition(position) {
        if (position === NbPosition.LEFT) {
            return this._direction === NbLayoutDirection.LTR ? NbPosition.START : NbPosition.END;
        }
        if (position === NbPosition.RIGHT) {
            return this._direction === NbLayoutDirection.LTR ? NbPosition.END : NbPosition.START;
        }
        return position;
    }
    persistChosenPositions(positions) {
        const positionGrid = this._direction === NbLayoutDirection.RTL ? RTL_PHYSICAL_POSITIONS : POSITIONS;
        this.appliedPositions = positions.map((position) => ({
            key: position,
            connectedPosition: positionGrid[position](this._offset),
        }));
    }
    reorderPreferredPositions(positions) {
        // Physical positions should be mapped to logical as adjustments use logical positions.
        const startPosition = this.mapToLogicalPosition(this._position);
        const startPositionIndex = positions.indexOf(startPosition);
        const firstPart = positions.slice(startPositionIndex);
        const secondPart = positions.slice(0, startPositionIndex);
        return firstPart.concat(secondPart);
    }
}
export class NbGlobalPositionStrategy extends GlobalPositionStrategy {
    position(position) {
        switch (position) {
            case NbGlobalLogicalPosition.TOP_START:
                return this.top().left();
            case NbGlobalLogicalPosition.TOP_END:
                return this.top().right();
            case NbGlobalLogicalPosition.BOTTOM_START:
                return this.bottom().left();
            case NbGlobalLogicalPosition.BOTTOM_END:
                return this.bottom().right();
        }
    }
}
export class NbPositionBuilderService {
    constructor(document, viewportRuler, platform, positionBuilder, overlayContainer) {
        this.document = document;
        this.viewportRuler = viewportRuler;
        this.platform = platform;
        this.positionBuilder = positionBuilder;
        this.overlayContainer = overlayContainer;
    }
    global() {
        return new NbGlobalPositionStrategy();
    }
    connectedTo(elementRef) {
        return new NbAdjustableConnectedPositionStrategy(elementRef, this.viewportRuler, this.document, this.platform, this.overlayContainer)
            .withFlexibleDimensions(false)
            .withPush(false);
    }
}
NbPositionBuilderService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbPositionBuilderService, deps: [{ token: NB_DOCUMENT }, { token: i1.NbViewportRulerAdapter }, { token: i2.NbPlatform }, { token: i3.NbOverlayPositionBuilder }, { token: i4.NbOverlayContainerAdapter }], target: i0.ɵɵFactoryTarget.Injectable });
NbPositionBuilderService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbPositionBuilderService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbPositionBuilderService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [NB_DOCUMENT]
                }] }, { type: i1.NbViewportRulerAdapter }, { type: i2.NbPlatform }, { type: i3.NbOverlayPositionBuilder }, { type: i4.NbOverlayContainerAdapter }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1wb3NpdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvdGhlbWUvY29tcG9uZW50cy9jZGsvb3ZlcmxheS9vdmVybGF5LXBvc2l0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBYyxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTlELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUdyQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDckQsT0FBTyxFQUlMLG1DQUFtQyxHQUlwQyxNQUFNLFdBQVcsQ0FBQztBQUluQixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQzs7Ozs7O0FBR3hFLE1BQU0sQ0FBTixJQUFZLFlBTVg7QUFORCxXQUFZLFlBQVk7SUFDdEIsNkJBQWEsQ0FBQTtJQUNiLHVDQUF1QixDQUFBO0lBQ3ZCLHFEQUFxQyxDQUFBO0lBQ3JDLHFDQUFxQixDQUFBO0lBQ3JCLHlDQUF5QixDQUFBO0FBQzNCLENBQUMsRUFOVyxZQUFZLEtBQVosWUFBWSxRQU12QjtBQWlCRCxNQUFNLENBQU4sSUFBWSxVQWVYO0FBZkQsV0FBWSxVQUFVO0lBQ3BCLHlCQUFXLENBQUE7SUFDWCwrQkFBaUIsQ0FBQTtJQUNqQiwyQkFBYSxDQUFBO0lBQ2IsNkJBQWUsQ0FBQTtJQUNmLDZCQUFlLENBQUE7SUFDZix5QkFBVyxDQUFBO0lBQ1gsaUNBQW1CLENBQUE7SUFDbkIscUNBQXVCLENBQUE7SUFDdkIsdUNBQXlCLENBQUE7SUFDekIsMkNBQTZCLENBQUE7SUFDN0IsaUNBQW1CLENBQUE7SUFDbkIsdUNB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QixrQkFBYSxHQUFiLGFBQWEsQ0FBd0I7UUFDckMsYUFBUSxHQUFSLFFBQVEsQ0FBWTtRQUNwQixvQkFBZSxHQUFmLGVBQWUsQ0FBMEI7UUFDekMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUEyQjtJQUNwRCxDQUFDO0lBRUosTUFBTTtRQUNKLE9BQU8sSUFBSSx3QkFBd0IsRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFFRCxXQUFXLENBQUMsVUFBc0I7UUFDaEMsT0FBTyxJQUFJLHFDQUFxQyxDQUM5QyxVQUFVLEVBQ1YsSUFBSSxDQUFDLGFBQWEsRUFDbEIsSUFBSSxDQUFDLFFBQVEsRUFDYixJQUFJLENBQUMsUUFBUSxFQUNiLElBQUksQ0FBQyxnQkFBZ0IsQ0FDdEI7YUFDRSxzQkFBc0IsQ0FBQyxLQUFLLENBQUM7YUFDN0IsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUM7O3FIQXZCVSx3QkFBd0Isa0JBRXpCLFdBQVc7eUhBRlYsd0JBQXdCOzJGQUF4Qix3QkFBd0I7a0JBRHBDLFVBQVU7OzBCQUdOLE1BQU07MkJBQUMsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYsIEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgR2xvYmFsUG9zaXRpb25TdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcblxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBOQl9ET0NVTUVOVCB9IGZyb20gJy4uLy4uLy4uL3RoZW1lLm9wdGlvbnMnO1xuaW1wb3J0IHtcbiAgTmJDb25uZWN0ZWRPdmVybGF5UG9zaXRpb25DaGFuZ2UsXG4gIE5iQ29ubmVjdGVkUG9zaXRpb24sXG4gIE5iQ29ubmVjdGlvblBvc2l0aW9uUGFpcixcbiAgTmJGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXG4gIE5iT3ZlcmxheVBvc2l0aW9uQnVpbGRlcixcbiAgTmJPdmVybGF5UmVmLFxuICBOYlBvc2l0aW9uU3RyYXRlZ3ksXG59IGZyb20gJy4vbWFwcGluZyc7XG5pbXBvcnQgeyBOYlBsYXRmb3JtIH0gZnJvbSAnLi4vcGxhdGZvcm0vcGxhdGZvcm0tc2VydmljZSc7XG5pbXBvcnQgeyBOYk92ZXJsYXlDb250YWluZXJBZGFwdGVyIH0gZnJvbSAnLi4vYWRhcHRlci9vdmVybGF5LWNvbnRhaW5lci1hZGFwdGVyJztcbmltcG9ydCB7IE5iVmlld3BvcnRSdWxlckFkYXB0ZXIgfSBmcm9tICcuLi9hZGFwdGVyL3ZpZXdwb3J0LXJ1bGVyLWFkYXB0ZXInO1xuaW1wb3J0IHsgTmJHbG9iYWxMb2dpY2FsUG9zaXRpb24gfSBmcm9tICcuL3Bvc2l0aW9uLWhlbHBlcic7XG5pbXBvcnQgeyBOYkxheW91dERpcmVjdGlvbiB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2RpcmVjdGlvbi5zZXJ2aWNlJztcblxuZXhwb3J0IHR5cGUgTmJBZGp1c3RtZW50VmFsdWVzID0gJ25vb3AnIHwgJ2Nsb2Nrd2lzZScgfCAnY291bnRlcmNsb2Nrd2lzZScgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnO1xuZXhwb3J0IGVudW0gTmJBZGp1c3RtZW50IHtcbiAgTk9PUCA9ICdub29wJyxcbiAgQ0xPQ0tXSVNFID0gJ2Nsb2Nrd2lzZScsXG4gIENPVU5URVJDTE9DS1dJU0UgPSAnY291bnRlcmNsb2Nrd2lzZScsXG4gIFZFUlRJQ0FMID0gJ3ZlcnRpY2FsJyxcbiAgSE9SSVpPTlRBTCA9ICdob3Jpem9udGFsJyxcbn1cblxuZXhwb3J0IHR5cGUgTmJQb3NpdGlvblZhbHVlcyA9XG4gIHwgJ3RvcCdcbiAgfCAnYm90dG9tJ1xuICB8ICdsZWZ0J1xuICB8ICdyaWdodCdcbiAgfCAnc3RhcnQnXG4gIHwgJ2VuZCdcbiAgfCAndG9wLWVuZCdcbiAgfCAndG9wLXN0YXJ0J1xuICB8ICdib3R0b20tZW5kJ1xuICB8ICdib3R0b20tc3RhcnQnXG4gIHwgJ2VuZC10b3AnXG4gIHwgJ2VuZC1ib3R0b20nXG4gIHwgJ3N0YXJ0LXRvcCdcbiAgfCAnc3RhcnQtYm90dG9tJztcbmV4cG9ydCBlbnVtIE5iUG9zaXRpb24ge1xuICBUT1AgPSAndG9wJyxcbiAgQk9UVE9NID0gJ2JvdHRvbScsXG4gIExFRlQgPSAnbGVmdCcsXG4gIFJJR0hUID0gJ3JpZ2h0JyxcbiAgU1RBUlQgPSAnc3RhcnQnLFxuICBFTkQgPSAnZW5kJyxcbiAgVE9QX0VORCA9ICd0b3AtZW5kJyxcbiAgVE9QX1NUQVJUID0gJ3RvcC1zdGFydCcsXG4gIEJPVFRPTV9FTkQgPSAnYm90dG9tLWVuZCcsXG4gIEJPVFRPTV9TVEFSVCA9ICdib3R0b20tc3RhcnQnLFxuICBFTkRfVE9QID0gJ2VuZC10b3AnLFxuICBFTkRfQk9UVE9NID0gJ2VuZC1ib3R0b20nLFxuICBTVEFSVF9UT1AgPSAnc3RhcnQtdG9wJyxcbiAgU1RBUlRfQk9UVE9NID0gJ3N0YXJ0LWJvdHRvbScsXG59XG5cbmNvbnN0IFBPU0lUSU9OUyA9IHtcbiAgW05iUG9zaXRpb24uUklHSFRdKG9mZnNldCkge1xuICAgIHJldHVybiB7IG9yaWdpblg6ICdlbmQnLCBvcmlnaW5ZOiAnY2VudGVyJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAnY2VudGVyJywgb2Zmc2V0WDogb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLkJPVFRPTV0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ2NlbnRlcicsIG9yaWdpblk6ICdib3R0b20nLCBvdmVybGF5WDogJ2NlbnRlcicsIG92ZXJsYXlZOiAndG9wJywgb2Zmc2V0WTogb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLkxFRlRdKG9mZnNldCkge1xuICAgIHJldHVybiB7IG9yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICdjZW50ZXInLCBvdmVybGF5WDogJ2VuZCcsIG92ZXJsYXlZOiAnY2VudGVyJywgb2Zmc2V0WDogLW9mZnNldCB9O1xuICB9LFxuICBbTmJQb3NpdGlvbi5UT1BdKG9mZnNldCkge1xuICAgIHJldHVybiB7IG9yaWdpblg6ICdjZW50ZXInLCBvcmlnaW5ZOiAndG9wJywgb3ZlcmxheVg6ICdjZW50ZXInLCBvdmVybGF5WTogJ2JvdHRvbScsIG9mZnNldFk6IC1vZmZzZXQgfTtcbiAgfSxcbiAgW05iUG9zaXRpb24uU1RBUlRdKG9mZnNldCkge1xuICAgIHJldHVybiB0aGlzW05iUG9zaXRpb24uTEVGVF0ob2Zmc2V0KTtcbiAgfSxcbiAgW05iUG9zaXRpb24uRU5EXShvZmZzZXQpIHtcbiAgICByZXR1cm4gdGhpc1tOYlBvc2l0aW9uLlJJR0hUXShvZmZzZXQpO1xuICB9LFxuICBbTmJQb3NpdGlvbi5FTkRfVE9QXShvZmZzZXQpIHtcbiAgICByZXR1cm4geyBvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ2JvdHRvbScsIG92ZXJsYXlYOiAnc3RhcnQnLCBvdmVybGF5WTogJ2JvdHRvbScsIG9mZnNldFg6IG9mZnNldCB9O1xuICB9LFxuICBbTmJQb3NpdGlvbi5FTkRfQk9UVE9NXShvZmZzZXQpIHtcbiAgICByZXR1cm4geyBvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ3RvcCcsIG92ZXJsYXlYOiAnc3RhcnQnLCBvdmVybGF5WTogJ3RvcCcsIG9mZnNldFg6IG9mZnNldCB9O1xuICB9LFxuICBbTmJQb3NpdGlvbi5CT1RUT01fU1RBUlRdKG9mZnNldCkge1xuICAgIHJldHVybiB7IG9yaWdpblg6ICdlbmQnLCBvcmlnaW5ZOiAnYm90dG9tJywgb3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ3RvcCcsIG9mZnNldFk6IG9mZnNldCB9O1xuICB9LFxuICBbTmJQb3NpdGlvbi5CT1RUT01fRU5EXShvZmZzZXQpIHtcbiAgICByZXR1cm4geyBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJywgb2Zmc2V0WTogb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLlNUQVJUX1RPUF0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ3N0YXJ0Jywgb3JpZ2luWTogJ2JvdHRvbScsIG92ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdib3R0b20nLCBvZmZzZXRYOiAtb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLlNUQVJUX0JPVFRPTV0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ3N0YXJ0Jywgb3JpZ2luWTogJ3RvcCcsIG92ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICd0b3AnLCBvZmZzZXRYOiAtb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLlRPUF9TVEFSVF0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ2VuZCcsIG9yaWdpblk6ICd0b3AnLCBvdmVybGF5WDogJ2VuZCcsIG92ZXJsYXlZOiAnYm90dG9tJywgb2Zmc2V0WTogLW9mZnNldCB9O1xuICB9LFxuICBbTmJQb3NpdGlvbi5UT1BfRU5EXShvZmZzZXQpIHtcbiAgICByZXR1cm4geyBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAndG9wJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAnYm90dG9tJywgb2Zmc2V0WTogLW9mZnNldCB9O1xuICB9LFxufTtcblxuY29uc3QgUlRMX1BIWVNJQ0FMX1BPU0lUSU9OUyA9IHtcbiAgLi4uUE9TSVRJT05TLFxuICBbTmJQb3NpdGlvbi5SSUdIVF0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ3N0YXJ0Jywgb3JpZ2luWTogJ2NlbnRlcicsIG92ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdjZW50ZXInLCBvZmZzZXRYOiBvZmZzZXQgfTtcbiAgfSxcbiAgW05iUG9zaXRpb24uTEVGVF0ob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHsgb3JpZ2luWDogJ2VuZCcsIG9yaWdpblk6ICdjZW50ZXInLCBvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICdjZW50ZXInLCBvZmZzZXRYOiAtb2Zmc2V0IH07XG4gIH0sXG4gIFtOYlBvc2l0aW9uLlNUQVJUXShvZmZzZXQpIHtcbiAgICByZXR1cm4gdGhpc1tOYlBvc2l0aW9uLlJJR0hUXShvZmZzZXQpO1xuICB9LFxuICBbTmJQb3NpdGlvbi5FTkRdKG9mZnNldCkge1xuICAgIHJldHVybiB0aGlzW05iUG9zaXRpb24uTEVGVF0ob2Zmc2V0KTtcbiAgfSxcbn07XG5cbmNvbnN0IENPVU5URVJfQ0xPQ0tXSVNFX1BPU0lUSU9OUyA9IFtcbiAgTmJQb3NpdGlvbi5UT1AsXG4gIE5iUG9zaXRpb24uVE9QX0VORCxcbiAgTmJQb3NpdGlvbi5UT1BfU1RBUlQsXG4gIE5iUG9zaXRpb24uU1RBUlQsXG4gIE5iUG9zaXRpb24uU1RBUlRfVE9QLFxuICBOYlBvc2l0aW9uLlNUQVJUX0JPVFRPTSxcbiAgTmJQb3NpdGlvbi5CT1RUT00sXG4gIE5iUG9zaXRpb24uQk9UVE9NX1NUQVJULFxuICBOYlBvc2l0aW9uLkJPVFRPTV9FTkQsXG4gIE5iUG9zaXRpb24uRU5ELFxuICBOYlBvc2l0aW9uLkVORF9CT1RUT00sXG4gIE5iUG9zaXRpb24uRU5EX1RPUCxcbl07XG5jb25zdCBDTE9DS1dJU0VfUE9TSVRJT05TID0gW1xuICBOYlBvc2l0aW9uLlRPUCxcbiAgTmJQb3NpdGlvbi5UT1BfU1RBUlQsXG4gIE5iUG9zaXRpb24uVE9QX0VORCxcbiAgTmJQb3NpdGlvbi5FTkQsXG4gIE5iUG9zaXRpb24uRU5EX1RPUCxcbiAgTmJQb3NpdGlvbi5FTkRfQk9UVE9NLFxuICBOYlBvc2l0aW9uLkJPVFRPTSxcbiAgTmJQb3NpdGlvbi5CT1RUT01fRU5ELFxuICBOYlBvc2l0aW9uLkJPVFRPTV9TVEFSVCxcbiAgTmJQb3NpdGlvbi5TVEFSVCxcbiAgTmJQb3NpdGlvbi5TVEFSVF9CT1RUT00sXG4gIE5iUG9zaXRpb24uU1RBUlRfVE9QLFxuXTtcbmNvbnN0IFZFUlRJQ0FMX1BPU0lUSU9OUyA9IFtOYlBvc2l0aW9uLkJPVFRPTSwgTmJQb3NpdGlvbi5UT1BdO1xuY29uc3QgSE9SSVpPTlRBTF9QT1NJVElPTlMgPSBbTmJQb3NpdGlvbi5TVEFSVCwgTmJQb3NpdGlvbi5FTkRdO1xuXG5mdW5jdGlvbiBjb21wYXJlUG9zaXRpb25zKHAxOiBOYkNvbm5lY3RlZFBvc2l0aW9uLCBwMjogTmJDb25uZWN0ZWRQb3NpdGlvbik6IGJvb2xlYW4ge1xuICByZXR1cm4gKFxuICAgIHAxLm9yaWdpblggPT09IHAyLm9yaWdpblggJiYgcDEub3JpZ2luWSA9PT0gcDIub3JpZ2luWSAmJiBwMS5vdmVybGF5WCA9PT0gcDIub3ZlcmxheVggJiYgcDEub3ZlcmxheVkgPT09IHAyLm92ZXJsYXlZXG4gICk7XG59XG5cbi8qKlxuICogVGhlIG1haW4gaWRlYSBvZiB0aGUgYWRqdXN0YWJsZSBjb25uZWN0ZWQgc3RyYXRlZ3kgaXMgdG8gcHJvdmlkZSBwcmVkZWZpbmVkIHNldCBvZiBwb3NpdGlvbnMgZm9yIHlvdXIgb3ZlcmxheS5cbiAqIFlvdSBoYXZlIHRvIHByb3ZpZGUgYWRqdXN0bWVudCBhbmQgYXBwcm9wcmlhdGUgc3RyYXRlZ3kgd2lsbCBiZSBjaG9zZW4gaW4gcnVudGltZS5cbiAqICovXG5leHBvcnQgY2xhc3MgTmJBZGp1c3RhYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneVxuICBleHRlbmRzIE5iRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5XG4gIGltcGxlbWVudHMgTmJQb3NpdGlvblN0cmF0ZWd5XG57XG4gIHByb3RlY3RlZCBfcG9zaXRpb246IE5iUG9zaXRpb247XG4gIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXIgPSAxNTtcbiAgcHJvdGVjdGVkIF9hZGp1c3RtZW50OiBOYkFkanVzdG1lbnQ7XG4gIHByb3RlY3RlZCBfZGlyZWN0aW9uOiBOYkxheW91dERpcmVjdGlvbiB8IHVuZGVmaW5lZDtcblxuICBwcm90ZWN0ZWQgYXBwbGllZFBvc2l0aW9uczogeyBrZXk6IE5iUG9zaXRpb247IGNvbm5lY3RlZFBvc2l0aW9uOiBOYkNvbm5lY3RlZFBvc2l0aW9uIH1bXTtcblxuICByZWFkb25seSBwb3NpdGlvbkNoYW5nZTogT2JzZXJ2YWJsZTxOYlBvc2l0aW9uPiA9IHRoaXMucG9zaXRpb25DaGFuZ2VzLnBpcGUoXG4gICAgbWFwKChwb3NpdGlvbkNoYW5nZTogTmJDb25uZWN0ZWRPdmVybGF5UG9zaXRpb25DaGFuZ2UpID0+IHBvc2l0aW9uQ2hhbmdlLmNvbm5lY3Rpb25QYWlyKSxcbiAgICBtYXAoKGNvbm5lY3Rpb25QYWlyOiBOYkNvbm5lY3Rpb25Qb3NpdGlvblBhaXIpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmFwcGxpZWRQb3NpdGlvbnMuZmluZCgoeyBjb25uZWN0ZWRQb3NpdGlvbiB9KSA9PiB7XG4gICAgICAgIHJldHVybiBjb21wYXJlUG9zaXRpb25zKGNvbm5lY3RlZFBvc2l0aW9uLCBjb25uZWN0aW9uUGFpcik7XG4gICAgICB9KS5rZXk7XG4gICAgfSksXG4gICk7XG5cbiAgYXR0YWNoKG92ZXJsYXlSZWY6IE5iT3ZlcmxheVJlZikge1xuICAgIC8qKlxuICAgICAqIFdlIGhhdmUgdG8gYXBwbHkgcG9zaXRpb25zIGJlZm9yZSBhdHRhY2ggYmVjYXVzZSBzdXBlci5hdHRhY2goKSB2YWxpZGF0ZXMgcG9zaXRpb25zIGFuZCBjcmFzaGVzIGFwcFxuICAgICAqIGlmIG5vIHBvc2l0aW9ucyBwcm92aWRlZC5cbiAgICAgKiAqL1xuICAgIHRoaXMuYXBwbHlQb3NpdGlvbnMoKTtcbiAgICBzdXBlci5hdHRhY2gob3ZlcmxheVJlZik7XG4gIH1cblxuICBkaXJlY3Rpb24oZGlyZWN0aW9uOiBOYkxheW91dERpcmVjdGlvbik6IHRoaXMge1xuICAgIHRoaXMuX2RpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFwcGx5KCkge1xuICAgIHRoaXMuYXBwbHlQb3NpdGlvbnMoKTtcbiAgICBzdXBlci5hcHBseSgpO1xuICB9XG5cbiAgcG9zaXRpb24ocG9zaXRpb246IE5iUG9zaXRpb24pOiB0aGlzIHtcbiAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRqdXN0bWVudChhZGp1c3RtZW50OiBOYkFkanVzdG1lbnQpOiB0aGlzIHtcbiAgICB0aGlzLl9hZGp1c3RtZW50ID0gYWRqdXN0bWVudDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9mZnNldChvZmZzZXQ6IG51bWJlcik6IHRoaXMge1xuICAgIHRoaXMuX29mZnNldCA9IG9mZnNldDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByb3RlY3RlZCBhcHBseVBvc2l0aW9ucygpIHtcbiAgICBjb25zdCBwb3NpdGlvbnM6IE5iUG9zaXRpb25bXSA9IHRoaXMuY3JlYXRlUG9zaXRpb25zKCk7XG4gICAgdGhpcy5wZXJzaXN0Q2hvc2VuUG9zaXRpb25zKHBvc2l0aW9ucyk7XG4gICAgdGhpcy53aXRoUG9zaXRpb25zKHRoaXMuYXBwbGllZFBvc2l0aW9ucy5tYXAoKHsgY29ubmVjdGVkUG9zaXRpb24gfSkgPT4gY29ubmVjdGVkUG9zaXRpb24pKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVQb3NpdGlvbnMoKTogTmJQb3NpdGlvbltdIHtcbiAgICBzd2l0Y2ggKHRoaXMuX2FkanVzdG1lbnQpIHtcbiAgICAgIGNhc2UgTmJBZGp1c3RtZW50Lk5PT1A6XG4gICAgICAgIHJldHVybiBbdGhpcy5fcG9zaXRpb25dO1xuICAgICAgY2FzZSBOYkFkanVzdG1lbnQuQ0xPQ0tXSVNFOlxuICAgICAgICByZXR1cm4gdGhpcy5yZW9yZGVyUHJlZmVycmVkUG9zaXRpb25zKENMT0NLV0lTRV9QT1NJVElPTlMpO1xuICAgICAgY2FzZSBOYkFkanVzdG1lbnQuQ09VTlRFUkNMT0NLV0lTRTpcbiAgICAgICAgcmV0dXJuIHRoaXMucmVvcmRlclByZWZlcnJlZFBvc2l0aW9ucyhDT1VOVEVSX0NMT0NLV0lTRV9QT1NJVElPTlMpO1xuICAgICAgY2FzZSBOYkFkanVzdG1lbnQuSE9SSVpPTlRBTDpcbiAgICAgICAgcmV0dXJuIHRoaXMucmVvcmRlclByZWZlcnJlZFBvc2l0aW9ucyhIT1JJWk9OVEFMX1BPU0lUSU9OUyk7XG4gICAgICBjYXNlIE5iQWRqdXN0bWVudC5WRVJUSUNBTDpcbiAgICAgICAgcmV0dXJuIHRoaXMucmVvcmRlclByZWZlcnJlZFBvc2l0aW9ucyhWRVJUSUNBTF9QT1NJVElPTlMpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBtYXBUb0xvZ2ljYWxQb3NpdGlvbihwb3NpdGlvbjogTmJQb3NpdGlvbik6IE5iUG9zaXRpb24ge1xuICAgIGlmIChwb3NpdGlvbiA9PT0gTmJQb3NpdGlvbi5MRUZUKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZGlyZWN0aW9uID09PSBOYkxheW91dERpcmVjdGlvbi5MVFIgPyBOYlBvc2l0aW9uLlNUQVJUIDogTmJQb3NpdGlvbi5FTkQ7XG4gICAgfVxuICAgIGlmIChwb3NpdGlvbiA9PT0gTmJQb3NpdGlvbi5SSUdIVCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbiA9PT0gTmJMYXlvdXREaXJlY3Rpb24uTFRSID8gTmJQb3NpdGlvbi5FTkQgOiBOYlBvc2l0aW9uLlNUQVJUO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb247XG4gIH1cblxuICBwcm90ZWN0ZWQgcGVyc2lzdENob3NlblBvc2l0aW9ucyhwb3NpdGlvbnM6IE5iUG9zaXRpb25bXSkge1xuICAgIGNvbnN0IHBvc2l0aW9uR3JpZCA9IHRoaXMuX2RpcmVjdGlvbiA9PT0gTmJMYXlvdXREaXJlY3Rpb24uUlRMID8gUlRMX1BIWVNJQ0FMX1BPU0lUSU9OUyA6IFBPU0lUSU9OUztcblxuICAgIHRoaXMuYXBwbGllZFBvc2l0aW9ucyA9IHBvc2l0aW9ucy5tYXAoKHBvc2l0aW9uKSA9PiAoe1xuICAgICAga2V5OiBwb3NpdGlvbixcbiAgICAgIGNvbm5lY3RlZFBvc2l0aW9uOiBwb3NpdGlvbkdyaWRbcG9zaXRpb25dKHRoaXMuX29mZnNldCkgYXMgTmJDb25uZWN0ZWRQb3NpdGlvbixcbiAgICB9KSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVvcmRlclByZWZlcnJlZFBvc2l0aW9ucyhwb3NpdGlvbnM6IE5iUG9zaXRpb25bXSk6IE5iUG9zaXRpb25bXSB7XG4gICAgLy8gUGh5c2ljYWwgcG9zaXRpb25zIHNob3VsZCBiZSBtYXBwZWQgdG8gbG9naWNhbCBhcyBhZGp1c3RtZW50cyB1c2UgbG9naWNhbCBwb3NpdGlvbnMuXG4gICAgY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHRoaXMubWFwVG9Mb2dpY2FsUG9zaXRpb24odGhpcy5fcG9zaXRpb24pO1xuICAgIGNvbnN0IHN0YXJ0UG9zaXRpb25JbmRleCA9IHBvc2l0aW9ucy5pbmRleE9mKHN0YXJ0UG9zaXRpb24pO1xuICAgIGNvbnN0IGZpcnN0UGFydCA9IHBvc2l0aW9ucy5zbGljZShzdGFydFBvc2l0aW9uSW5kZXgpO1xuICAgIGNvbnN0IHNlY29uZFBhcnQgPSBwb3NpdGlvbnMuc2xpY2UoMCwgc3RhcnRQb3NpdGlvbkluZGV4KTtcbiAgICByZXR1cm4gZmlyc3RQYXJ0LmNvbmNhdChzZWNvbmRQYXJ0KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTmJHbG9iYWxQb3NpdGlvblN0cmF0ZWd5IGV4dGVuZHMgR2xvYmFsUG9zaXRpb25TdHJhdGVneSB7XG4gIHBvc2l0aW9uKHBvc2l0aW9uOiBOYkdsb2JhbExvZ2ljYWxQb3NpdGlvbik6IHRoaXMge1xuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICAgIGNhc2UgTmJHbG9iYWxMb2dpY2FsUG9zaXRpb24uVE9QX1NUQVJUOlxuICAgICAgICByZXR1cm4gdGhpcy50b3AoKS5sZWZ0KCk7XG5cbiAgICAgIGNhc2UgTmJHbG9iYWxMb2dpY2FsUG9zaXRpb24uVE9QX0VORDpcbiAgICAgICAgcmV0dXJuIHRoaXMudG9wKCkucmlnaHQoKTtcblxuICAgICAgY2FzZSBOYkdsb2JhbExvZ2ljYWxQb3NpdGlvbi5CT1RUT01fU1RBUlQ6XG4gICAgICAgIHJldHVybiB0aGlzLmJvdHRvbSgpLmxlZnQoKTtcblxuICAgICAgY2FzZSBOYkdsb2JhbExvZ2ljYWxQb3NpdGlvbi5CT1RUT01fRU5EOlxuICAgICAgICByZXR1cm4gdGhpcy5ib3R0b20oKS5yaWdodCgpO1xuICAgIH1cbiAgfVxufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTmJQb3NpdGlvbkJ1aWxkZXJTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChOQl9ET0NVTUVOVCkgcHJvdGVjdGVkIGRvY3VtZW50LFxuICAgIHByb3RlY3RlZCB2aWV3cG9ydFJ1bGVyOiBOYlZpZXdwb3J0UnVsZXJBZGFwdGVyLFxuICAgIHByb3RlY3RlZCBwbGF0Zm9ybTogTmJQbGF0Zm9ybSxcbiAgICBwcm90ZWN0ZWQgcG9zaXRpb25CdWlsZGVyOiBOYk92ZXJsYXlQb3NpdGlvbkJ1aWxkZXIsXG4gICAgcHJvdGVjdGVkIG92ZXJsYXlDb250YWluZXI6IE5iT3ZlcmxheUNvbnRhaW5lckFkYXB0ZXIsXG4gICkge31cblxuICBnbG9iYWwoKTogTmJHbG9iYWxQb3NpdGlvblN0cmF0ZWd5IHtcbiAgICByZXR1cm4gbmV3IE5iR2xvYmFsUG9zaXRpb25TdHJhdGVneSgpO1xuICB9XG5cbiAgY29ubmVjdGVkVG8oZWxlbWVudFJlZjogRWxlbWVudFJlZik6IE5iQWRqdXN0YWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3kge1xuICAgIHJldHVybiBuZXcgTmJBZGp1c3RhYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneShcbiAgICAgIGVsZW1lbnRSZWYsXG4gICAgICB0aGlzLnZpZXdwb3J0UnVsZXIsXG4gICAgICB0aGlzLmRvY3VtZW50LFxuICAgICAgdGhpcy5wbGF0Zm9ybSxcbiAgICAgIHRoaXMub3ZlcmxheUNvbnRhaW5lcixcbiAgICApXG4gICAgICAud2l0aEZsZXhpYmxlRGltZW5zaW9ucyhmYWxzZSlcbiAgICAgIC53aXRoUHVzaChmYWxzZSk7XG4gIH1cbn1cbiJdfQ==