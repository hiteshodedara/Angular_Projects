/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
import { Injectable } from '@angular/core';
import { batch, range } from '../helpers';
import * as i0 from "@angular/core";
import * as i1 from "./date.service";
export class NbCalendarMonthModelService {
    constructor(dateService) {
        this.dateService = dateService;
    }
    createDaysGrid(activeMonth, boundingMonth = true) {
        const weeks = this.createDates(activeMonth);
        return this.withBoundingMonths(weeks, activeMonth, boundingMonth);
    }
    createDates(activeMonth) {
        const days = this.createDateRangeForMonth(activeMonth);
        const startOfWeekDayDiff = this.getStartOfWeekDayDiff(activeMonth);
        return batch(days, this.dateService.DAYS_IN_WEEK, startOfWeekDayDiff);
    }
    withBoundingMonths(weeks, activeMonth, boundingMonth) {
        let withBoundingMonths = weeks;
        if (this.isShouldAddPrevBoundingMonth(withBoundingMonths)) {
            withBoundingMonths = this.addPrevBoundingMonth(withBoundingMonths, activeMonth, boundingMonth);
        }
        if (this.isShouldAddNextBoundingMonth(withBoundingMonths)) {
            withBoundingMonths = this.addNextBoundingMonth(withBoundingMonths, activeMonth, boundingMonth);
        }
        return withBoundingMonths;
    }
    addPrevBoundingMonth(weeks, activeMonth, boundingMonth) {
        const firstWeek = weeks.shift();
        const requiredItems = this.dateService.DAYS_IN_WEEK - firstWeek.length;
        firstWeek.unshift(...this.createPrevBoundingDays(activeMonth, boundingMonth, requiredItems));
        return [firstWeek, ...weeks];
    }
    addNextBoundingMonth(weeks, activeMonth, boundingMonth) {
        const lastWeek = weeks.pop();
        const requiredItems = this.dateService.DAYS_IN_WEEK - lastWeek.length;
        lastWeek.push(...this.createNextBoundingDays(activeMonth, boundingMonth, requiredItems));
        return [...weeks, lastWeek];
    }
    createPrevBoundingDays(activeMonth, boundingMonth, requiredItems) {
        const month = this.dateService.addMonth(activeMonth, -1);
        const daysInMonth = this.dateService.getNumberOfDaysInMonth(month);
        return this.createDateRangeForMonth(month)
            .slice(daysInMonth - requiredItems)
            .map(date => boundingMonth ? date : null);
    }
    createNextBoundingDays(activeMonth, boundingMonth, requiredItems) {
        const month = this.dateService.addMonth(activeMonth, 1);
        return this.createDateRangeForMonth(month)
            .slice(0, requiredItems)
            .map(date => boundingMonth ? date : null);
    }
    getStartOfWeekDayDiff(date) {
        const startOfMonth = this.dateService.getMonthStart(date);
        return this.getWeekStartDiff(startOfMonth);
    }
    getWeekStartDiff(date) {
        return (7 - this.dateService.getFirstDayOfWeek() + this.dateService.getDayOfWeek(date)) % 7;
    }
    isShouldAddPrevBoundingMonth(weeks) {
        return weeks[0].length < this.dateService.DAYS_IN_WEEK;
    }
    isShouldAddNextBoundingMonth(weeks) {
        return weeks[weeks.length - 1].length < this.dateService.DAYS_IN_WEEK;
    }
    createDateRangeForMonth(date) {
        const daysInMonth = this.dateService.getNumberOfDaysInMonth(date);
        return range(daysInMonth, i => {
            const year = this.dateService.getYear(date);
            const month = this.dateService.getMonth(date);
            return this.dateService.createDate(year, month, i + 1);
        });
    }
}
NbCalendarMonthModelService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbCalendarMonthModelService, deps: [{ token: i1.NbDateService }], target: i0.ɵɵFactoryTarget.Injectable });
NbCalendarMonthModelService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbCalendarMonthModelService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: NbCalendarMonthModelService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.NbDateService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItbW9udGgtbW9kZWwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvdGhlbWUvY29tcG9uZW50cy9jYWxlbmRhci1raXQvc2VydmljZXMvY2FsZW5kYXItbW9udGgtbW9kZWwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUczQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLFlBQVksQ0FBQzs7O0FBSTFDLE1BQU0sT0FBTywyQkFBMkI7SUFFdEMsWUFBc0IsV0FBNkI7UUFBN0IsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO0lBQ25ELENBQUM7SUFFRCxjQUFjLENBQUMsV0FBYyxFQUFFLGdCQUF5QixJQUFJO1FBQzFELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDNUMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRU8sV0FBVyxDQUFDLFdBQWM7UUFDaEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ25FLE9BQU8sS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFFTyxrQkFBa0IsQ0FBQyxLQUFZLEVBQUUsV0FBYyxFQUFFLGFBQXNCO1FBQzdFLElBQUksa0JBQWtCLEdBQUcsS0FBSyxDQUFDO1FBRS9CLElBQUksSUFBSSxDQUFDLDRCQUE0QixD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LENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM5RixDQUFDO0lBRU8sNEJBQTRCLENBQUMsS0FBWTtRQUMvQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUM7SUFDekQsQ0FBQztJQUVPLDRCQUE0QixDQUFDLEtBQVk7UUFDL0MsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUM7SUFDeEUsQ0FBQztJQUVPLHVCQUF1QixDQUFDLElBQU87UUFDckMsTUFBTSxXQUFXLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxRSxPQUFPLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDNUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7O3dIQW5GVSwyQkFBMkI7NEhBQTNCLDJCQUEyQjsyRkFBM0IsMkJBQTJCO2tCQUR2QyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEFrdmVvLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IE5iRGF0ZVNlcnZpY2UgfSBmcm9tICcuL2RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBiYXRjaCwgcmFuZ2UgfSBmcm9tICcuLi9oZWxwZXJzJztcblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTmJDYWxlbmRhck1vbnRoTW9kZWxTZXJ2aWNlPEQ+IHtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZGF0ZVNlcnZpY2U6IE5iRGF0ZVNlcnZpY2U8RD4pIHtcbiAgfVxuXG4gIGNyZWF0ZURheXNHcmlkKGFjdGl2ZU1vbnRoOiBELCBib3VuZGluZ01vbnRoOiBib29sZWFuID0gdHJ1ZSk6IERbXVtdIHtcbiAgICBjb25zdCB3ZWVrcyA9IHRoaXMuY3JlYXRlRGF0ZXMoYWN0aXZlTW9udGgpO1xuICAgIHJldHVybiB0aGlzLndpdGhCb3VuZGluZ01vbnRocyh3ZWVrcywgYWN0aXZlTW9udGgsIGJvdW5kaW5nTW9udGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEYXRlcyhhY3RpdmVNb250aDogRCk6IERbXVtdIHtcbiAgICBjb25zdCBkYXlzID0gdGhpcy5jcmVhdGVEYXRlUmFuZ2VGb3JNb250aChhY3RpdmVNb250aCk7XG4gICAgY29uc3Qgc3RhcnRPZldlZWtEYXlEaWZmID0gdGhpcy5nZXRTdGFydE9mV2Vla0RheURpZmYoYWN0aXZlTW9udGgpO1xuICAgIHJldHVybiBiYXRjaChkYXlzLCB0aGlzLmRhdGVTZXJ2aWNlLkRBWVNfSU5fV0VFSywgc3RhcnRPZldlZWtEYXlEaWZmKTtcbiAgfVxuXG4gIHByaXZhdGUgd2l0aEJvdW5kaW5nTW9udGhzKHdlZWtzOiBEW11bXSwgYWN0aXZlTW9udGg6IEQsIGJvdW5kaW5nTW9udGg6IGJvb2xlYW4pOiBEW11bXSB7XG4gICAgbGV0IHdpdGhCb3VuZGluZ01vbnRocyA9IHdlZWtzO1xuXG4gICAgaWYgKHRoaXMuaXNTaG91bGRBZGRQcmV2Qm91bmRpbmdNb250aCh3aXRoQm91bmRpbmdNb250aHMpKSB7XG4gICAgICB3aXRoQm91bmRpbmdNb250aHMgPSB0aGlzLmFkZFByZXZCb3VuZGluZ01vbnRoKHdpdGhCb3VuZGluZ01vbnRocywgYWN0aXZlTW9udGgsIGJvdW5kaW5nTW9udGgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzU2hvdWxkQWRkTmV4dEJvdW5kaW5nTW9udGgod2l0aEJvdW5kaW5nTW9udGhzKSkge1xuICAgICAgd2l0aEJvdW5kaW5nTW9udGhzID0gdGhpcy5hZGROZXh0Qm91bmRpbmdNb250aCh3aXRoQm91bmRpbmdNb250aHMsIGFjdGl2ZU1vbnRoLCBib3VuZGluZ01vbnRoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gd2l0aEJvdW5kaW5nTW9udGhzO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRQcmV2Qm91bmRpbmdNb250aCh3ZWVrczogRFtdW10sIGFjdGl2ZU1vbnRoOiBELCBib3VuZGluZ01vbnRoOiBib29sZWFuKTogRFtdW10ge1xuICAgIGNvbnN0IGZpcnN0V2VlayA9IHdlZWtzLnNoaWZ0KCk7XG4gICAgY29uc3QgcmVxdWlyZWRJdGVtczogbnVtYmVyID0gdGhpcy5kYXRlU2VydmljZS5EQVlTX0lOX1dFRUsgLSBmaXJzdFdlZWsubGVuZ3RoO1xuICAgIGZpcnN0V2Vlay51bnNoaWZ0KC4uLnRoaXMuY3JlYXRlUHJldkJvdW5kaW5nRGF5cyhhY3RpdmVNb250aCwgYm91bmRpbmdNb250aCwgcmVxdWlyZWRJdGVtcykpO1xuICAgIHJldHVybiBbZmlyc3RXZWVrLCAuLi53ZWVrc107XG4gIH1cblxuICBwcml2YXRlIGFkZE5leHRCb3VuZGluZ01vbnRoKHdlZWtzOiBEW11bXSwgYWN0aXZlTW9udGg6IEQsIGJvdW5kaW5nTW9udGg6IGJvb2xlYW4pOiBEW11bXSB7XG4gICAgY29uc3QgbGFzdFdlZWsgPSB3ZWVrcy5wb3AoKTtcbiAgICBjb25zdCByZXF1aXJlZEl0ZW1zOiBudW1iZXIgPSB0aGlzLmRhdGVTZXJ2aWNlLkRBWVNfSU5fV0VFSyAtIGxhc3RXZWVrLmxlbmd0aDtcbiAgICBsYXN0V2Vlay5wdXNoKC4uLnRoaXMuY3JlYXRlTmV4dEJvdW5kaW5nRGF5cyhhY3RpdmVNb250aCwgYm91bmRpbmdNb250aCwgcmVxdWlyZWRJdGVtcykpO1xuICAgIHJldHVybiBbLi4ud2Vla3MsIGxhc3RXZWVrXTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUHJldkJvdW5kaW5nRGF5cyhhY3RpdmVNb250aDogRCwgYm91bmRpbmdNb250aDogYm9vbGVhbiwgcmVxdWlyZWRJdGVtczogbnVtYmVyKTogRFtdIHtcbiAgICBjb25zdCBtb250aCA9IHRoaXMuZGF0ZVNlcnZpY2UuYWRkTW9udGgoYWN0aXZlTW9udGgsIC0xKTtcbiAgICBjb25zdCBkYXlzSW5Nb250aCA9IHRoaXMuZGF0ZVNlcnZpY2UuZ2V0TnVtYmVyT2ZEYXlzSW5Nb250aChtb250aCk7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlRGF0ZVJhbmdlRm9yTW9udGgobW9udGgpXG4gICAgICAuc2xpY2UoZGF5c0luTW9udGggLSByZXF1aXJlZEl0ZW1zKVxuICAgICAgLm1hcChkYXRlID0+IGJvdW5kaW5nTW9udGggPyBkYXRlIDogbnVsbCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU5leHRCb3VuZGluZ0RheXMoYWN0aXZlTW9udGg6IEQsIGJvdW5kaW5nTW9udGg6IGJvb2xlYW4sIHJlcXVpcmVkSXRlbXM6IG51bWJlcik6IERbXSB7XG4gICAgY29uc3QgbW9udGggPSB0aGlzLmRhdGVTZXJ2aWNlLmFkZE1vbnRoKGFjdGl2ZU1vbnRoLCAxKTtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVEYXRlUmFuZ2VGb3JNb250aChtb250aClcbiAgICAgIC5zbGljZSgwLCByZXF1aXJlZEl0ZW1zKVxuICAgICAgLm1hcChkYXRlID0+IGJvdW5kaW5nTW9udGggPyBkYXRlIDogbnVsbCk7XG4gIH1cblxuICBwcml2YXRlIGdldFN0YXJ0T2ZXZWVrRGF5RGlmZihkYXRlOiBEKTogbnVtYmVyIHtcbiAgICBjb25zdCBzdGFydE9mTW9udGggPSB0aGlzLmRhdGVTZXJ2aWNlLmdldE1vbnRoU3RhcnQoZGF0ZSk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0V2Vla1N0YXJ0RGlmZihzdGFydE9mTW9udGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRXZWVrU3RhcnREaWZmKGRhdGU6IEQpOiBudW1iZXIge1xuICAgIHJldHVybiAoNyAtIHRoaXMuZGF0ZVNlcnZpY2UuZ2V0Rmlyc3REYXlPZldlZWsoKSArIHRoaXMuZGF0ZVNlcnZpY2UuZ2V0RGF5T2ZXZWVrKGRhdGUpKSAlIDc7XG4gIH1cblxuICBwcml2YXRlIGlzU2hvdWxkQWRkUHJldkJvdW5kaW5nTW9udGgod2Vla3M6IERbXVtdKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHdlZWtzWzBdLmxlbmd0aCA8IHRoaXMuZGF0ZVNlcnZpY2UuREFZU19JTl9XRUVLO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1Nob3VsZEFkZE5leHRCb3VuZGluZ01vbnRoKHdlZWtzOiBEW11bXSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB3ZWVrc1t3ZWVrcy5sZW5ndGggLSAxXS5sZW5ndGggPCB0aGlzLmRhdGVTZXJ2aWNlLkRBWVNfSU5fV0VFSztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRGF0ZVJhbmdlRm9yTW9udGgoZGF0ZTogRCk6IERbXSB7XG4gICAgY29uc3QgZGF5c0luTW9udGg6IG51bWJlciA9IHRoaXMuZGF0ZVNlcnZpY2UuZ2V0TnVtYmVyT2ZEYXlzSW5Nb250aChkYXRlKTtcbiAgICByZXR1cm4gcmFuZ2UoZGF5c0luTW9udGgsIGkgPT4ge1xuICAgICAgY29uc3QgeWVhciA9IHRoaXMuZGF0ZVNlcnZpY2UuZ2V0WWVhcihkYXRlKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gdGhpcy5kYXRlU2VydmljZS5nZXRNb250aChkYXRlKTtcbiAgICAgIHJldHVybiB0aGlzLmRhdGVTZXJ2aWNlLmNyZWF0ZURhdGUoeWVhciwgbW9udGgsIGkgKyAxKVxuICAgIH0pO1xuICB9XG59XG4iXX0=